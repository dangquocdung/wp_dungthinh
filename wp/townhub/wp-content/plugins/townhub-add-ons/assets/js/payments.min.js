!function(c){"use strict";var s,i,n,r,l,u,m;c(document).on("click",".next-form",function(e){if(e.preventDefault(),!m){m=!0;var t=c(this),n=(c("#townhub-checkout-form")[0],!1),a=null;if(s=t.closest(".ck-fieldset-item"),(i=s.next(".ck-fieldset-item")).length){c(".ck-input-error").remove(),c(".inp-error").removeClass("inp-error");var o=s.find("input");o.length&&o.each(function(){var e=c(this);if("hidden"===e.prop("type")||!0===e.prop("disabled"))return!0;if(!0===e.prop("required")){if(""==e.val()&&("text"===e.prop("type")||"number"===e.prop("type")||"email"===e.prop("type")))return a=this,!(n=!0);if(!1===e.prop("checked")&&("checkbox"===e.prop("type")||"radio"===e.prop("type")))return a=this,!(n=!0)}}),n?(c(a).after('<span class="ck-input-error">'+a.validationMessage+"</span>"),c(a).addClass("inp-error"),m=!1):(c(".ck-input-error").remove(),c(".inp-error").removeClass("inp-error"),c(".ck-tab-item").removeClass("active"),c(".ck-tab-item").eq(c(".ck-fieldset-item").index(i)).addClass("active"),i.show(),s.animate({opacity:0},{step:function(e,t){u=1-.2*(1-e),r=50*e+"%",l=1-e,s.css({transform:"scale("+u+")",position:"absolute"}),i.css({left:r,opacity:l,position:"relative"})},duration:1200,complete:function(){s.hide(),m=!1},easing:"easeInOutBack"}))}}}),c(document).on("click",".back-form",function(e){if(e.preventDefault(),m)return!1;m=!0;var t=c(this);s=t.closest(".ck-fieldset-item"),n=t.closest(".ck-fieldset-item").prev(".ck-fieldset-item"),c(".ck-tab-item").removeClass("active"),c(".ck-tab-item").eq(c(".ck-fieldset-item").index(n)).addClass("active"),n.show(),s.animate({opacity:0},{step:function(e,t){u=.8+.2*(1-e),r=50*(1-e)+"%",l=1-e,s.css({left:r,position:"absolute"}),n.css({transform:"scale("+u+")",opacity:l,position:"relative"})},duration:1200,complete:function(){s.hide(),m=!1},easing:"easeInOutBack"})}),c(document).on("submit","#townhub-checkout-form",function(e){e.preventDefault();var t=new FormData(this),s=c(this),i=c(this).find(".lcheckout_btn");i.addClass("loading"),t.append("action","checkout_form"),c.ajax({type:"POST",url:_townhub_add_ons.url,dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(e){if(null!=e.debug&&1==e.debug&&console.log(e),e.success)if(i.removeClass("loading"),null!=e.scform_data&&""!=e.scform_data&&null!=e.scform_url){var t=document.createElement("form");if(null!=e.scform_class&&""!=e.scform_class?t.className="ck-second-form "+e.scform_class:t.className="ck-second-form",t.method="POST",t.action=e.scform_url,e.scform_data instanceof Object)for(var n in e.scform_data){var a=document.createElement("INPUT");a.name=n,a.value=e.scform_data[n],a.type="hidden",t.appendChild(a)}if(s.before(t),null!=e.scform_before&&""!=e.scform_before&&s.before(e.scform_before),s.remove(),null!=e.scform_submit&&1==e.scform_submit)t.submit();else{var o=document.createElement("INPUT");o.name="submit",o.value="Confirm",o.type="submit",t.appendChild(o)}}else null!=e.url&&""!=e.url?window.location.href=e.url:c("#ck-tab-ck_confirm").length&&c("#ck-fieldset-ck_confirm").length?(c(".ck-tab-item").removeClass("active"),c("#ck-tab-ck_confirm").addClass("active"),c(".ck-fieldset-item").hide(),c("#ck-fieldset-ck_confirm").show().addClass("ck-fieldset-show")):null!=e.result&&""!=e.result&&(c("#ck-tab-ck_confirm").length&&(c(".ck-tab-item").removeClass("active"),c("#ck-tab-ck_confirm").addClass("active")),s.before(e.result),s.remove())},error:function(e){console.log(e)}})}),c(document).on("change",'input[type="radio"][name="payment-method"]',function(e){e.preventDefault();var t=c(this).data("btn")||"",n=c(this).val(),a=c("#lcheckout_btn");t&&a.children(".btn-text").text(t),"stripe"===n?a.addClass("stripe-checkout"):a.removeClass("stripe-checkout")});var a=StripeCheckout.configure({key:_townhub_add_ons_payments.publishable_key,image:_townhub_add_ons_payments.logo,locale:"auto",currency:_townhub_add_ons_payments.currency_code,token:function(e){var t=c("#townhub-checkout-form");t.append('<input type="hidden" name="stripeToken" value="'+e.id+'">'),t.append('<input type="hidden" name="stripeEmail" value="'+e.email+'">'),t.submit()}});c(document).on("click","#lcheckout_btn",function(e){if(c(this).hasClass("stripe-checkout")){var t=c(this).data("payment");null!=t&&(t=c.extend({},{amount:5390,plan:"Basic",email:"",is_recurring:!1},JSON.parse(decodeURIComponent(t)))),a.open({name:_townhub_add_ons_payments.site_title,description:t.is_recurring?_townhub_add_ons_payments.recurring_text.replace("{{plan}}",t.plan):_townhub_add_ons_payments.one_time_text.replace("{{plan}}",t.plan),amount:t.amount,email:_townhub_add_ons_payments.use_email?t.email:""}),e.preventDefault()}}),window.addEventListener("popstate",function(){a.close()})}(jQuery);