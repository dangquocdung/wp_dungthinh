!function(e,t){"use strict";t.Eval=t.Value.extend({set:function(e){var t=this._value;return e=this._setter.apply(this,arguments),null===(e=this.validate(e))?this:(this._value=e,this._dirty=!0,this.callbacks.fireWith(this,[e,t]),this)}}),t.variable=new t.Eval,t.Fields=t.Class.extend({defaults:{title:"",desc:"",default:"",type:"text",active:!0,parent:"",priority:10},initialize:function(i,a){var n=this;n.id=i,n.params=_.extend({},n.defaults,n.params||{},a||{}),n.params.link='data-link="true"',["coordinate","deviceheight","cubemap"].indexOf(n.params.type)>0?n.value=new t.Eval:n.value=new t.Value,n.value.set(n.params.value),n.active=new t.Value,n.active.set(!0),n.active.bind(function(e){n.onChangeActive(e)}),n.deferred={embedded:new e.Deferred},n.embed(),n.deferred.embedded.done(function(){n.listenLink(),n.attachEvent(),n.ready(),n.afterReady()});var s=n.params.parent,r=s.id;s.containerHolder.bind(r,function(e){e.loaded&&(n.loaded(),n.value.bind(function(e){t.variable.set({field:n.params.fieldName,value:e})}))})},onChangeActive:function(e){e?this.element.slideDown("fast"):this.element.slideUp("fast")},embed:function(){var t=this.params.parent.element;this.element=e(this.renderContent()),t.append(this.element),this.deferred.embedded.resolve()},renderContent:function(){var t,i=this.params.type;if(t=0!==e("#tmpl-wvt-field-"+i).length?wp.template("wvt-field-"+i):wp.template("wvt-field-standart"))return t(this.params)},listenLink:function(){var t=this;e(t.element).find("[data-link]").change(function(){t.value.set(e(this).val())})},attachEvent:function(){},ready:function(){},afterReady:function(){},loaded:function(){this.activeField()},compare:function(e,t,i){return"==="===i?e===t:"="===i||"=="===i||"equals"===i||"equal"===i?e==t:"!="===i?e!==t:"!="===i||"not equal"===i?e!==t:">="===i||"greater or equal"===i||"equal or greater"===i?e>=t:"<="===i||"smaller or equal"===i||"equal or smaller"===i?e<=t:">"===i||"greater"===i?e>t:"<"===i||"smaller"===i?e<t:"in"===i||"contains"===i?e.indexOf(t)>=0:void 0},getStatus:function(e){var t=this,i=t.params.parent.fields,a=!0;return _.each(e,function(e){var n=i(e.field);a=a&&t.compare(e.value,n.value.get(),e.operator)}),a},setActiveStatus:function(e,t){var i=e.getStatus(t);e.active.set(i)},activeField:function(){var e=this,t=e.params.parent.fields;if(void 0!==e.params.dependency){var i=e.params.dependency;i.length>0&&(e.setActiveStatus(e,i),_.each(i,function(a){t(a.field).value.bind(function(){e.setActiveStatus(e,i)})}))}}}),t.radioImageField=t.Fields.extend({}),t.colorField=t.Fields.extend({attachEvent:function(){var t=e(this.element),i=e(t).find(".jeg-color-picker-clone"),a=e(t).find(".jeg-color-picker");i.wpColorPicker({change:function(t,i){var n=i.color.toString();e(a).val(n).trigger("change")},clear:function(){e(a).val("").trigger("change")}})}}),t.sliderField=t.Fields.extend({attachEvent:function(){var t=e(this.element).find("input[type=range]"),i=t.attr("value"),a=this;t.closest("div").find(".jeg_range_value .value").text(i),t.on("input",function(){var t=e(this).val();a.value.set(t),e(this).closest("div").find(".jeg_range_value .value").text(t)})}}),t.iconPickerField=t.Fields.extend({attachEvent:function(){var t=this;e(t.element).find(".iconpicker").iconpicker({arrowPrevIconClass:"fa fa-chevron-left",arrowNextIconClass:"fa fa-chevron-right",iconset:"fontawesome"}).on("change",function(e){t.value.set(e.icon)})}}),t.selectField=t.Fields.extend({isValidOption:function(e){return void 0!==e[0]&&void 0!==e[0].value&&void 0!==e[0].text},setupOption:function(e){if(this.isValidOption(e))return e;var t=[];return _.each(e,function(e,i){t.push({value:i,text:e})}),t},ajaxCall:function(e,t){var i;if(!e.length||e.length<3)return t();i=void 0!==window.wvt_global.id?window.wvt_global.id:"",wp.ajax.send(this.params.ajax,{data:{query:e,nonce:this.params.nonce,exclude:i}}).done(function(e){t(e)})},attachEvent:function(){var e=this,t=this.setupOption(e.params.options),i=e.params.value;""!==i&&0===t.length?wp.ajax.send(e.params.ajaxoptions,{data:{value:i,nonce:e.params.nonce}}).done(function(t){e.renderSelect(t)}):e.renderSelect(t)},renderSelect:function(t){var i=this,a=null,n={};i.params.multiple||i.params.ajax?(a=e(this.element).find("input"),n={plugins:["drag_drop"],multiple:i.params.multiple,hideSelected:!0,options:t,render:{option:function(e){return"<div><span>"+e.text+"</span></div>"}},onChange:function(e){i.value.set(e)},onItemAdd:function(){if(!i.params.multiple){var e=this.items;if(e.length>1)for(var t=0;t<e.length;t++)this.removeItem(e[t]),this.refreshOptions()}}},i.params.delete&&n.plugins.push("remove_button")):(a=e(i.element).find("select"),n={allowEmptyOption:!0,onChange:function(e){i.value.set(e)}}),""!==i.params.ajax&&(n.load=i.ajaxCall.bind(i),n.create=!0),e(a).selectize(n)}}),t.checkboxField=t.Fields.extend({ready:function(){var t,i=this;e(i.element).find("input").change(function(){t=e(this).is(":checked")?"1":"0",i.value.set(t)})}}),t.coordinateField=t.Fields.extend({ready:function(){var t=this;e(t.element).on("change click keyup paste","input",function(){var i=e(this).attr("data-coordinate"),a=t.value.get();a[i]=parseInt(e(this).val()),t.value.set(a)})},setFieldValue:function(e){var t=this;_.each(e,function(e,i){t.element.find("[data-coordinate="+i+"]").val(e)}),t.value.set(e)},attachEvent:function(){var t=this;e(this.element).find(".coordinate-reset").click(function(){_.each(t.params.default,function(e,i){t.element.find("[data-coordinate="+i+"]").val(e)}),t.value.set(t.params.default)})}}),t.textField=t.Fields.extend({setFieldValue:function(e){this.element.find("input").val(e),this.value.set(e)},ready:function(){var t=this;e(t.element).on("change click keyup paste","input",function(){t.value.set(e(this).val())})}}),t.textareaField=t.textField.extend({ready:function(){var t=this;e(t.element).on("change click keyup paste","textarea",function(){t.value.set(e(this).val())})}}),t.texteditorField=t.textField.extend({ready:function(){var e=this,t=e.params.parent.id+"_"+e.params.fieldID;tinymce.init({selector:"#"+t,setup:function(t){t.on("NodeChange",function(){e.value.set(t.getContent())})}}),quicktags({id:t})}}),t.numberField=t.Fields.extend({ready:function(){var t=this,i=e(this.element).find("input"),a=e(this).attr("min"),n=e(this).attr("max"),s=e(this).attr("step");e(i).spinner({min:a,max:n,step:s,stop:function(){t.value.set(e(this).val())}})}}),t.imageField=t.Fields.extend({ready:function(){this.createMediaUploadInstance(),this.$add=e(this.element).find(".add-media-button"),this.$select=e(this.element).find(".select-media-button"),this.$remove=e(this.element).find(".remove-media-button"),this.$change=e(this.element).find(".change-media-button"),this.$holder=e(this.element).find(".image-holder"),this.$image=e(this.element).find(".image-holder img"),this.$empty=e(this.element).find(".image-empty"),this.$filled=e(this.element).find(".image-filled"),this.$add.on("click",this.onAddClicked.bind(this)),this.$select.on("click",this.onAddClicked.bind(this)),this.$remove.on("click",this.onRemoveClicked.bind(this)),this.$change.on("click",this.onAddClicked.bind(this)),this.$holder.on("click",this.onAddClicked.bind(this))},createMediaUploadInstance:function(){this.mediaUpload=wp.media({frame:"post",state:"insert",multiple:!1}),this.mediaUpload.on("insert",this.insertImage.bind(this))},insertImage:function(){const e=this.mediaUpload.state().get("selection").first().toJSON();this.addImage(e)},addImage:function(e){const t={id:e.id,src:e.sizes.full.url};this.value.set(t),this.$image.attr("src",t.src),this.$empty.addClass("hide"),this.$filled.removeClass("hide")},openDialog:function(){this.mediaUpload.open()},onAddClicked:function(){this.openDialog()},onRemoveClicked:function(){this.value.set(""),this.$image.attr("src",""),this.$empty.removeClass("hide"),this.$filled.addClass("hide")}}),t.cssField=t.Fields.extend({ready:function(){var e=wp.codeEditor.initialize(this.element.find("textarea")),t=this;e.codemirror.on("change",function(){var i=e.codemirror.getValue();t.value.set(i)})}}),t.deviceHeightField=t.Fields.extend({ready:function(){this.element.find(".device-item").each(this.deviceControl.bind(this))},deviceControl:function(t,i){var a=this,n=e(i).attr("data-device"),s=e(i).find("input[type=range]");s.on("mousedown",function(){e(this).mousemove(function(){var t=e(this).attr("value");a.setValue(t,n),e(this).closest("div").find(".jeg_range_value .value").text(t)})}),s.click(function(){var t=e(this).attr("value");a.setValue(t,n),e(this).closest("div").find(".jeg_range_value .value").text(t)}),e(i).find(".jeg-slider-reset").click(function(){var t=s,i=t.data("reset_value");t.val(i),t.change(),a.setValue(i,n),e(this).closest("div.wrapper").find(".jeg_range_value .value").text(i)})},setValue:function(e,t){var i=this.value.get();i[t]=parseInt(e),this.value.set(i)}}),t.cubemapField=t.Fields.extend({ready:function(){var t=e(this.element).find(".cubemap-list ul li");this.createMediaUploadInstance(),t.on("click",this.openDialog.bind(this)),t.find(".remove").on("click",this.removeImage.bind(this))},createMediaUploadInstance:function(){var e=this;e.mediaUpload=wp.media({frame:"post",state:"insert",multiple:!1}),e.mediaUpload.on("insert",function(){var t=e.mediaUpload.state().get("selection").first().toJSON();e.addImage(t,e.lastPosition),e.mediaUpload.close()})},addImage:function(e,t){var i=this.element.find('li[data-position="'+t+'"]'),a={id:e.id,src:e.sizes.full.url};i.addClass("contain"),this.doAddImage(i,t,a)},doAddImage:function(t,i,a){e(t).find(".cubemap-bg").css("background-image","url("+a.src+")"),e(t).find("input").val(a);var n=this.value.get();""===n&&(n={}),n[i]=a,this.value.set(n)},openDialog:function(t){this.lastPosition=e(t.currentTarget).data("position"),this.mediaUpload.open()},removeImage:function(t){t.stopPropagation();var i=e(t.currentTarget).parents("li").get(0);i=e(i).data("position");var a=this.element.find('li[data-position="'+i+'"]');a.removeClass("contain"),a.find("input").val("");var n=this.value.get();n[i]=null,this.value.set(n)}});var i=function(e,t,i){var a=this;this.rowIndex=e,this.container=t,this.label=i,this.header=this.container.find(".repeater-row-header"),this.header.on("click",function(){a.toggleMinimize()}),this.container.on("click",".repeater-row-remove",function(){a.remove()}),this.header.on("mousedown",function(){a.container.trigger("row:start-dragging")}),this.container.on("keyup change","input, select, textarea",function(e){a.container.trigger("row:update",[a.rowIndex,jQuery(e.target).data("field"),e.target])}),this.setRowIndex=function(e){this.rowIndex=e,this.container.attr("data-row",e),this.container.data("row",e),this.updateLabel()},this.toggleMinimize=function(){this.container.hasClass("minimized")?this.container.find(".repeater-row-content").slideDown("fast"):this.container.find(".repeater-row-content").slideUp("fast"),this.container.toggleClass("minimized"),this.header.find(".dashicons").toggleClass("dashicons-arrow-up").toggleClass("dashicons-arrow-down")},this.remove=function(){this.container.slideUp(300,function(){jQuery(this).detach()}),this.container.trigger("row:remove",[this.rowIndex])},this.updateLabel=function(){var e,t;"field"!==this.label.type||"function"!=typeof(e=this.container.find('.repeater-field [data-field="'+this.label.field+'"]')).val||""===(t=e.val())?this.header.find(".repeater-row-label").text(this.label.value+" "+(this.rowIndex+1)):this.header.find(".repeater-row-label").text(t)},this.updateLabel()};t.repeaterField=t.Fields.extend({ready:function(){var t,i,a=this;null===a.params.value&&(a.params.value=a.params.default);var n=e.isArray(a.params.value)?a.params.value:JSON.parse(decodeURIComponent(a.params.value));a.settingField=a.element.find("[data-customize-setting-link]").first(),a.setValue([],!1),a.repeaterFieldsContainer=a.element.find(".repeater-fields").first(),a.currentIndex=0,a.rows=[],t=!1,void 0!==a.params.choices.limit&&(t=!(0>=a.params.choices.limit)&&parseInt(a.params.choices.limit)),a.element.on("click","button.repeater-add",function(e){e.preventDefault(),!t||a.currentIndex<t?((i=a.addRow()).toggleMinimize(),a.initColorPicker(),a.initDropdownPages(i)):jQuery(a.selector+" .limit").addClass("highlight")}),a.element.on("click",".repeater-row-remove",function(e){a.currentIndex--,(!t||a.currentIndex<t)&&jQuery(a.selector+" .limit").removeClass("highlight")}),a.element.on("click keypress",".repeater-field-image .upload-button,.repeater-field-cropped_image .upload-button,.repeater-field-upload .upload-button",function(e){e.preventDefault(),a.$thisButton=jQuery(this),a.openFrame(e)}),a.element.on("click keypress",".repeater-field-image .remove-button,.repeater-field-cropped_image .remove-button",function(e){e.preventDefault(),a.$thisButton=jQuery(this),a.removeImage(e)}),a.element.on("click keypress",".repeater-field-upload .remove-button",function(e){e.preventDefault(),a.$thisButton=jQuery(this),a.removeFile(e)}),a.repeaterTemplate=function(){return wp.template("wvt-field-repeater-content")},n.length&&_.each(n,function(e){i=a.addRow(e),a.initColorPicker(),a.initDropdownPages(i,e)}),a.setValue(n,!0,!0),a.repeaterFieldsContainer.sortable({handle:".repeater-row-header",update:function(e,t){a.sort()}})},openFrame:function(e){wp.customize.utils.isKeydownButNotEnterEvent(e)||(this.$thisButton.closest(".repeater-field").hasClass("repeater-field-cropped_image")?this.initCropperFrame():this.initFrame(),this.frame.open())},initFrame:function(){var e=this.getMimeType(),t=null;"image"===e&&(t=wp.media.query({type:e})),this.frame=wp.media({states:[new wp.media.controller.Library({library:t,multiple:!1,date:!1})]}),this.frame.on("select",this.onSelect,this)},initCropperFrame:function(){var e=this.$thisButton.siblings("input.hidden-field").attr("data-field"),t=this.getMimeType();"string"==typeof e&&""!==e&&"object"==typeof this.params.fields[e]&&"cropped_image"===this.params.fields[e].type&&["width","height","flex_width","flex_height"].forEach(function(t,i){void 0!==this.params.fields[e][t]&&(this.params[t]=this.params.fields[e][t])}.bind(this)),this.frame=wp.media({button:{text:"Select and Crop",close:!1},states:[new wp.media.controller.Library({library:wp.media.query({type:t}),multiple:!1,date:!1,suggestedWidth:this.params.width,suggestedHeight:this.params.height}),new wp.media.controller.CustomizeImageCropper({imgSelectOptions:this.calculateImageSelectOptions,control:this})]}),this.frame.on("select",this.onSelectForCrop,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this)},onSelect:function(){var e=this.frame.state().get("selection").first().toJSON();this.$thisButton.closest(".repeater-field").hasClass("repeater-field-upload")?this.setFileInRepeaterField(e):this.setImageInRepeaterField(e)},onSelectForCrop:function(){var e=this.frame.state().get("selection").first().toJSON();this.params.width!==e.width||this.params.height!==e.height||this.params.flex_width||this.params.flex_height?this.frame.setState("cropper"):this.setImageInRepeaterField(e)},onCropped:function(e){this.setImageInRepeaterField(e)},calculateImageSelectOptions:function(e,t){var i,a,n,s=t.get("control"),r=!!parseInt(s.params.flex_width,10),o=!!parseInt(s.params.flex_height,10),l=e.get("width"),d=e.get("height"),c=parseInt(s.params.width,10),h=parseInt(s.params.height,10),u=c/h,p=l,f=d;return t.set("canSkipCrop",!s.mustBeCropped(r,o,c,h,l,d)),p/f>u?c=(h=f)*u:h=(c=p)/u,n={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:l,imageHeight:d,x1:i=(p-c)/2,y1:a=(f-h)/2,x2:c+i,y2:h+a},!1===o&&!1===r&&(n.aspectRatio=c+":"+h),!1===o&&(n.maxHeight=h),!1===r&&(n.maxWidth=c),n},mustBeCropped:function(e,t,i,a,n,s){return(!0!==e||!0!==t)&&((!0!==e||a!==s)&&((!0!==t||i!==n)&&((i!==n||a!==s)&&!(n<=i))))},onSkippedCrop:function(){var e=this.frame.state().get("selection").first().toJSON();this.setImageInRepeaterField(e)},setImageInRepeaterField:function(e){var t=this.$thisButton.closest(".repeater-field-image,.repeater-field-cropped_image");t.find(".jeg-image-attachment").html('<img src="'+e.url+'">').hide().slideDown("slow"),t.find(".hidden-field").val(e.url),this.$thisButton.text(this.$thisButton.data("alt-label")),t.find(".remove-button").show(),t.find("input, textarea, select").trigger("change"),this.frame.close()},setFileInRepeaterField:function(e){var t=this.$thisButton.closest(".repeater-field-upload");t.find(".jeg-file-attachment").html('<span class="file"><span class="dashicons dashicons-media-default"></span> '+e.filename+"</span>").hide().slideDown("slow"),t.find(".hidden-field").val(e.id),this.$thisButton.text(this.$thisButton.data("alt-label")),t.find(".upload-button").show(),t.find(".remove-button").show(),t.find("input, textarea, select").trigger("change"),this.frame.close()},getMimeType:function(){var e=this.$thisButton.siblings("input.hidden-field").attr("data-field");return"string"==typeof e&&""!==e&&"object"==typeof this.params.fields[e]&&"upload"===this.params.fields[e].type&&void 0!==this.params.fields[e].mime_type?this.params.fields[e].mime_type:"image"},removeImage:function(e){var t,i;wp.customize.utils.isKeydownButNotEnterEvent(e)||(i=(t=this.$thisButton.closest(".repeater-field-image,.repeater-field-cropped_image,.repeater-field-upload")).find(".upload-button"),t.find(".jeg-image-attachment").slideUp("fast",function(){jQuery(this).show().html(jQuery(this).data("placeholder"))}),t.find(".hidden-field").val(""),i.text(i.data("label")),this.$thisButton.hide(),t.find("input, textarea, select").trigger("change"))},removeFile:function(e){var t,i;wp.customize.utils.isKeydownButNotEnterEvent(e)||(i=(t=this.$thisButton.closest(".repeater-field-upload")).find(".upload-button"),t.find(".jeg-file-attachment").slideUp("fast",function(){jQuery(this).show().html(jQuery(this).data("placeholder"))}),t.find(".hidden-field").val(""),i.text(i.data("label")),this.$thisButton.hide(),t.find("input, textarea, select").trigger("change"))},getValue:function(){return e.isArray(this.params.value)?this.params.value:JSON.parse(decodeURIComponent(this.params.value))},setValue:function(t,i,a){var n=t,s=[];a&&(jQuery.each(this.params.fields,function(e,t){"image"!==t.type&&"cropped_image"!==t.type&&"upload"!==t.type||s.push(e)}),jQuery.each(t,function(e,t){jQuery.each(s,function(i,a){void 0!==t[a]&&void 0!==t[a].id&&(n[e][a]=t[a].id)})})),this.value.set(n),e(this.element).find(".data-setting").attr("value",encodeURI(JSON.stringify(n)))},addRow:function(e){var t,a,n,s=this,r=s.repeaterTemplate(),o=this.getValue(),l={};if(r){if(t=jQuery.extend(!0,{},s.params.fields),e)for(n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)&&(t[n].default=e[n]);for(n in t.index=this.currentIndex,r=r(t),(a=new i(s.currentIndex,jQuery(r).appendTo(s.repeaterFieldsContainer),s.params.row_label)).container.on("row:remove",function(e,t){s.deleteRow(t)}),a.container.on("row:update",function(e,t,i,n){s.updateField.call(s,e,t,i,n),a.updateLabel()}),this.rows[this.currentIndex]=a,t)t.hasOwnProperty(n)&&(l[n]=t[n].default);return o[this.currentIndex]=l,this.setValue(o,!0),this.currentIndex++,a}},sort:function(){var e=this,t=this.repeaterFieldsContainer.find(".repeater-row"),i=[],a=e.getValue(),n=[],s=[];t.each(function(e,t){i.push(jQuery(t).data("row"))}),jQuery.each(i,function(t,i){n[t]=e.rows[i],n[t].setRowIndex(t),s[t]=a[i]}),e.rows=n,e.setValue(s)},deleteRow:function(e){var t,i=this.getValue();for(t in i[e]&&this.rows[e]&&(delete i[e],delete this.rows[e],this.setValue(i,!0)),1,this.rows)this.rows.hasOwnProperty(t)&&this.rows[t]&&(this.rows[t].updateLabel(),0)},updateField:function(e,t,i,a){var n,s,r;this.rows[t]&&this.params.fields[i]&&(n=this.params.fields[i].type,s=this.rows[t],r=this.getValue(),a=jQuery(a),void 0!==typeof r[s.rowIndex][i]&&(r[s.rowIndex][i]="checkbox"===n?a.is(":checked"):a.val(),this.setValue(r,!0)))},initColorPicker:function(){var e=this,t=e.element.find(".color-picker-hex"),i={},a=t.data("field");void 0!==a&&void 0!==e.params.fields[a]&&void 0!==e.params.fields[a].palettes&&"object"==typeof e.params.fields[a].palettes&&(i.palettes=e.params.fields[a].palettes),i.change=function(t,i){var a=jQuery(t.target),n=a.closest(".repeater-row").data("row"),s=e.getValue();s[n][a.data("field")]=i.color.toString(),e.setValue(s,!0)},0!==t.length&&t.wpColorPicker(i)},initDropdownPages:function(e,t){var i,a,n=this,s=e.container.find(".repeater-dropdown-pages select");0!==s.length&&(i=jQuery(s).selectize()[0].selectize,a=s.data("field"),t&&i.setValue(t[a]),this.element.on("change",".repeater-dropdown-pages select",function(e){var t=jQuery(e.target),i=t.closest(".repeater-row").data("row"),a=n.getValue();a[i][t.data("field")]=jQuery(this).val(),n.setValue(a)}))}}),t.standartField=t.Fields.extend({}),t.headingField=t.Fields.extend({}),t.alertField=t.Fields.extend({}),t.fieldConstructor={text:t.textField,color:t.colorField,select:t.selectField,checkbox:t.checkboxField,radioimage:t.radioImageField,slider:t.sliderField,iconpicker:t.iconPickerField,standart:t.standartField,heading:t.headingField,alert:t.alertField,textarea:t.textareaField,texteditor:t.texteditorField,number:t.numberField,image:t.imageField,cubemap:t.cubemapField,repeater:t.repeaterField,coordinate:t.coordinateField,deviceheight:t.deviceHeightField,css:t.cssField}}(jQuery,wp.customize);