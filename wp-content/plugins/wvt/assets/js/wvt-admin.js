!function(t,n){"use strict";window.wvt=window.wvt||{},wvt.admin={},wvt.admin.timeout=null,wvt.admin.option={},wvt.admin.hotspot={},wvt.admin.tour={},wvt.admin.randomKey=function(t){for(var n="",i="abcdefghijklmnopqrstuvwxyz".length,o=0;o<t;o++)n+="abcdefghijklmnopqrstuvwxyz".charAt(Math.floor(Math.random()*i));return n},wvt.admin.shortcodeCopy=function(){var n=t(".wvt-shortcode-copied"),i=t(".wvt-shortcode-copy input");t(i).on("click",function(o){o.preventDefault(),t(i).focus().select(),document.execCommand("copy"),t(n).fadeIn(),setTimeout(function(){t(n).fadeOut()},1e3)})},wvt.admin.addSpotItem=function(n,i){n.id=i;var o=wvt.helper.addSpotItem(n),e=t(".panorama");t(".list-content ul").append(o),wvt.helper.scrollSpotList(e),wvt.helper.clickSpotItem(e,this.instance)},wvt.admin.prepareEditor=function(){this.fullscreenEditor(),this.panoramaHeight(),this.scrollbarPanel(),t(window).resize(function(){wvt.admin.panoramaHeight(),wvt.admin.scrollbarPanel()})},wvt.admin.scrollbarPanel=function(){var n=t(".wvt-panel"),i=n.find(".wvt-option-header").height(),o=t(document).height()-i,e=document.querySelector(".wvt-option-body");n.find(".wvt-option-body").css({height:o+"px"}),void 0===this.perfectScrollbar&&(this.perfectScrollbar=new PerfectScrollbar(e))},wvt.admin.getPreviewHeight=function(){var n=t(".wvt-preview"),i=n.find(".wvt-toolbar").height(),o=t(document).height()-i;return n.find(".wvt-panorama-container").css({height:o+"px"}),o},wvt.admin.panoramaHeight=function(){var n,i=wvt.admin.option.getValue("height"),o="",e=t(".wvt-panorama-container").width(),a=this.getPreviewHeight();for(var s in i)o+=(n=i[s]/100*e)<a?".wvt-panorama-container[data-device='"+s+"'] .panorama { height: "+n+"px; }":".wvt-panorama-container[data-device='"+s+"'] .panorama { height: "+a+"px; width: "+(e=a/(i[s]/100))+"px; }";t("#panorama-css").text(o)},wvt.admin.fullscreenEditor=function(){t(".wvt-edit").length&&t("html, body").addClass("wvt-single-panorama-editor")},wvt.admin.createTooltips=function(){t(".tooltip").tooltipster({theme:"tooltipster-borderless"})},wvt.admin.listenChangeDevice=function(){t(".wvt-media-chooser li").on("click",this.changeDevice)},wvt.admin.listenSetCenter=function(){t(".set-center").on("click",this.setCenter.bind(this))},wvt.admin.setCenter=function(){n.optioncontainer("option").segments("main-segment").fields("coordinate").setFieldValue({pitch:this.instance.getPitch(),yaw:this.instance.getYaw(),hfov:this.instance.getHfov()})},wvt.admin.listenSetNorth=function(){t(".set-north").on("click",this.setNorth.bind(this))},wvt.admin.listenSetEdit=function(){t(".set-edit").on("click",function(n){t('.wvt-option-header .tab-list[data-id="option"]').trigger("click")})},wvt.admin.setNorth=function(){n.optioncontainer("option").segments("main-segment").fields("north").setFieldValue(this.instance.getYaw())},wvt.admin.changeDevice=function(n){n.preventDefault();var i=t(this).data("device");t(".choose-media > i.fa").removeAttr("class").addClass("fa fa-"+i),t(".wvt-panorama-container").attr("data-device",i),window.dispatchEvent(new Event("resize"))},wvt.admin.listenSaveButton=function(){t(".wvt-toolbar .wvt-save-button").on("click",this.saveButton.bind(this))},wvt.admin.preventReload=function(t){window.onbeforeunload=t?function(){return!0}:null},wvt.admin.getCurrentValue=function(){var t={};n.optioncontainer("option").segments("main-segment").fields.each(function(n){t[n.id]=n.value.get()});var i=[];n.optioncontainer("hotspot").segments.each(function(t){var n={};t.fields.each(function(t){n[t.id]=t.value.get()}),i.push(n)});var o=[];return n.optioncontainer("tour").segments.each(function(t){var n={};t.fields.each(function(t){n[t.id]=t.value.get()}),o.push(n)}),{option:t,hotspot:i,tour:o}},wvt.admin.saveButton=function(t){t.preventDefault(),this.saveData(this.getCurrentValue())},wvt.admin.saveData=function(n){var i=t(".wvt-save-button");i.addClass("saving").text(wvt_global.lang.saving),this.ajaxPromise(n).done(function(){i.addClass("saved").text(wvt_global.lang.saved),wvt.admin.preventReload(!1),setTimeout(function(){i.removeClass("saving saved").text(wvt_global.lang.save)},1500)})},wvt.admin.ajaxPromise=function(t){return wp.ajax.send("save_ajax",{data:{data:t,nonce:wvt_global.nonce,post_id:wvt_global.id}})},wvt.admin.createPanellum=function(){var t=wvt.helper.panoramaOption(this.getCurrentValue()),n="panorama";wvt.helper.loader(n),this.instance=pannellum.viewer(n,t),this.contextMenu(),this.instance.on("load",function(){wvt.helper.createToolbar(n,t,wvt.admin.instance),wvt.helper.spotList(n,t,wvt.admin.instance),wvt.helper.singlePanoramaMap(n,t,wvt_global.id),wvt.helper.hideLoader(n)}.bind(this))},wvt.admin.updatePanellum=function(){clearTimeout(this.timeout),this.timeout=setTimeout(function(){this.instance.destroy(),this.createPanellum()}.bind(this),500)},wvt.admin.contextMenu=function(){var n=wvt_global.global,i="<a href='"+n.context_url+"' target='_blank'>"+n.context+"</a>";t("#panorama").find(".pnlm-about-msg").html(i)},wvt.admin.optionChanged=function(t,n){["type","equirectangular","cubemap","compass","equirectangular_external","equirectangular_external_url"].indexOf(t)>=0?this.updatePanellum():void 0!==this.option[t]&&this.option[t](n)},wvt.admin.globalVariableListener=function(){n.variable.bind(function(t){wvt.admin.preventReload(!0);var n=null,i=/^([^\[]+)\[(.*?)\]\[(.*?)\]/i;"option"===(n=i.test(t.field)?i.exec(t.field):/^([^\[]+)\[(.*?)\]/i.exec(t.field))[1]&&this.optionChanged(n[2],t.value),"hotspot"===n[1]&&this.hotspot.valueChanged(n[2],n[3],t.value),"tour"===n[1]&&this.tour.valueChanged(n[2],n[3],t.value)}.bind(this))},wvt.admin.showHelper=function(){var n=wp.template("wvt-flag-spot"),i=t("#panorama");(n=t(n())).find(".btn-new-tour").on("click",this.tour.newTour.bind(this)),n.find(".btn-new-hotspot").on("click",this.hotspot.newHotspot.bind(this)),i.append(n)},wvt.admin.option.getValue=function(t){return n.optioncontainer("option").segments("main-segment").fields(t).value.get()},wvt.admin.option.height=function(t){window.dispatchEvent(new Event("resize"))},wvt.admin.option.css=function(n){t("#additional-css").text(n)},wvt.admin.option.changeAutorotate=function(){var n="1"===this.getValue("autorotate"),i=this.getValue("autorotate_speed"),o=-1;"clockwise"!==this.getValue("autorotate_direction")&&(o=1),n?(wvt.admin.instance.startAutoRotate(i*o),t(".wvt-autorotate-control").addClass("rotating")):(wvt.admin.instance.stopAutoRotate(i*o),t(".wvt-autorotate-control").removeClass("rotating"))},wvt.admin.option.autorotate=function(){this.changeAutorotate()},wvt.admin.option.autorotate_speed=function(){this.changeAutorotate()},wvt.admin.option.autorotate_direction=function(){this.changeAutorotate()},wvt.admin.option.showHideTitleBox=function(){var n=this.getValue("title"),i=t(".wvt-panorama-title");""===n?i.css("display","none"):i.css("display","block")},wvt.admin.option.title=function(n){this.showHideTitleBox(),t(".wvt-panorama-title h2").html(n)},wvt.admin.option.fullscreen=function(n){"1"===n?t(".wvt-fullscreen-control").css("display","block"):t(".wvt-fullscreen-control").css("display","none")},wvt.admin.option.orientation=function(n){"1"===n?t(".wvt-orientation-control").css("display","block"):t(".wvt-orientation-control").css("display","none")},wvt.admin.option.zoom=function(n){"1"===n?t(".wvt-zoom-control").css("display","block"):t(".wvt-zoom-control").css("display","none")},wvt.admin.option.autorotate_button=function(n){"1"===n?t(".wvt-autorotate-control").css("display","block"):t(".wvt-autorotate-control").css("display","none")},wvt.admin.option.north=function(t){var n=wvt.helper.calculateNorth(t);wvt.admin.instance.setNorthOffset(n)},wvt.admin.option.spotlist=function(n){"1"===n?t(".wvt-spotlist-container").css("display","block"):t(".wvt-spotlist-container").css("display","none")},wvt.admin.option.enable_map=function(n){"1"===n?t(".wvt-single-map-container").css("visibility","visible"):t(".wvt-single-map-container").css("visibility","hidden")},wvt.admin.option.mapid=function(n){var i=t(".wvt-single-map-container");i.find(".wvt-tour-loader").fadeIn("slow"),n&&wvt.helper.callAjaxMap(i,n)},wvt.admin.option.mapdimension=function(n){var i=t(".pnlm-render-container").height()*(n/100),o=t(".pnlm-render-container").width()*(n/100);t(".wvt-single-map-container").css({height:i+"px",width:o+"px"})},wvt.admin.option.toolbar_scheme=function(t){wvt.helper.toolbarScheme(wvt.admin.instance.getContainer(),t)},wvt.admin.listenTour=function(){t(".create-tour").on("click",this.tour.handleTourClick.bind(this.tour))},wvt.admin.tour.handleTourClick=function(){t(".wvt-flag-spot").length||wvt.admin.showHelper();var n=t(".wvt-panorama-container");"tour"===n.attr("data-flag")?n.attr("data-flag","hide"):n.attr("data-flag","tour"),t('.wvt-option-header .tab-list[data-id="tour"]').trigger("click")},wvt.admin.tour.newTour=function(){t(".wvt-panorama-container").attr("data-flag","hide");var i=n.optioncontainer("tour").createMultiSegment({key:"wvt-tour-key-"+wvt.admin.randomKey(5),coordinate:{pitch:wvt.admin.instance.getPitch(),yaw:wvt.admin.instance.getYaw(),hfov:wvt.admin.instance.getHfov()}});return n.optioncontainer("tour").activateTab(),n.optioncontainer("tour").segments(i).activateSection(),this.addSpotItem(this.tour.getAllValue(i),i),!1},wvt.admin.listenTourSegmentEvent=function(){n.optioncontainer("tour").activeSegment.bind(this.tour.changeActiveSegment.bind(this.tour)),n.optioncontainer("tour").segmentEvent.bind(this.tour.listenSegmentEvent.bind(this.tour))},wvt.admin.tour.changeActiveSegment=function(t){var n=this.getAllValue(t).coordinate;wvt.admin.instance.lookAt(parseInt(n.pitch),parseInt(n.yaw),parseInt(n.hfov),1e3)},wvt.admin.tour.add=function(t){var n=wvt.helper.normalizeHotspotOption(t.id,this.getAllValue(t.id));wvt.admin.instance.addHotSpot(n)},wvt.admin.tour.getAllValue=function(t){var i={};return n.optioncontainer("tour").segments(t).fields.each(function(t){i[t.id]=t.value.get()}),i},wvt.admin.tour.listenSegmentEvent=function(t){this[t.type](t)},wvt.admin.tour.valueChanged=function(t,n,i){var o=wvt.helper.segmentName("tour",t),e=wvt.admin.instance.getHotSpotConfig(o);void 0!==wvt.admin.tour[n]&&wvt.admin.tour[n](e.div,i,o)},wvt.admin.tour.bgcolor=function(n,i){t(n).css({"background-color":i})},wvt.admin.tour.width=function(n,i){t(n).css({height:i,width:i,"line-height":i+"px"}),t(n).find("i").css({"line-height":i+"px"})},wvt.admin.tour.shape=function(i,o,e){var a=Object.keys(n.optioncontainer("tour").params.options.shape.options),s=this.getAllValue(e);if(t(i).removeClass(a.join(" ")),t(i).addClass(o),t(i).find("i").remove(),t(i).find("img").remove(),"badge"===o){var r=window.wvt_global.wvt_url+"/assets/img/badge/wvt-badge-"+s.badge+".png",c=t('<img class="hotspot-element badge" src="'+r+'"/>');t(i).css({"background-color":"transparent"}).prepend(c)}else{if("icon"===s.icontype){var d=t('<i class="fa '+s.icon+'"></i>').css({color:s.iconcolor,"font-size":s.iconsize+"px","line-height":s.width+"px"});t(i).prepend(d)}if("image"===s.icontype){c=t('<img src="'+s.iconimage+'"/>');t(i).prepend(c)}t(i).css({"background-color":s.bgcolor})}this.updateSpotList(e)},wvt.admin.tour.icontype=function(n,i,o){var e=this.getAllValue(o);if(t(n).find("i").remove(),t(n).find("img").remove(),"icon"===i){var a=t('<i class="fa '+e.icon+'"></i>').css({color:e.iconcolor,"font-size":e.iconsize+"px","line-height":e.width+"px"});t(n).prepend(a)}if("image"===i){var s=t('<img src="'+e.iconimage+'"/>');t(n).prepend(s)}this.updateSpotList(o)},wvt.admin.tour.icon=function(n,i,o){t(n).find("i").attr("class","tour-element fa "+i),this.updateSpotList(o)},wvt.admin.tour.iconimage=function(n,i,o){t(n).find("img").attr("src",i),this.updateSpotList(o)},wvt.admin.tour.badge=function(n,i,o){var e=window.wvt_global.wvt_url+"/assets/img/badge/wvt-badge-"+i+".png";t(n).find("img").attr("src",e),this.updateSpotList(o)},wvt.admin.tour.iconcolor=function(n,i,o){t(n).find("i").css({color:i}),this.updateSpotList(o)},wvt.admin.tour.iconsize=function(n,i,o){var e=this.getAllValue(o).width;t(n).find("i").css({"font-size":i+"px","line-height":e+"px"})},wvt.admin.tour.hoverValueChanged=function(n,i,o){var e=t(n).find(".hotspot-element"),a=this.getAllValue(o);wvt.helper.hotspotTooltipsItem(e,a)},wvt.admin.tour.hover=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.tour.hovertext=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.tour.hoverposition=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.tour.hoverminwidth=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.tour.hovermaxwidth=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.tour.hovertheme=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.tour.remove=function(t){wvt.admin.instance.removeHotSpot(t.id)},wvt.admin.tour.title=function(t,n,i){this.updateSpotList(i)},wvt.admin.tour.updateSpotList=function(n){var i,o=this.getAllValue(n);o.id=n,i=wvt.helper.addSpotItem(o),t(".wvt-spotlist-container li[data-id="+n+"]").replaceWith(i)},wvt.admin.listenHotspot=function(){t(".create-hotspot").on("click",this.hotspot.handleHotspotClick.bind(this.hotspot))},wvt.admin.listenHotspotSegmentEvent=function(){n.optioncontainer("hotspot").activeSegment.bind(this.hotspot.changeActiveSegment.bind(this.hotspot)),n.optioncontainer("hotspot").segmentEvent.bind(this.hotspot.listenSegmentEvent.bind(this.hotspot))},wvt.admin.hotspot.valueChanged=function(t,n,i){var o=wvt.helper.segmentName("hotspot",t),e=wvt.admin.instance.getHotSpotConfig(o);void 0!==wvt.admin.hotspot[n]&&wvt.admin.hotspot[n](e.div,i,o)},wvt.admin.hotspot.bgcolor=function(n,i){t(n).css({"background-color":i})},wvt.admin.hotspot.icon=function(n,i,o){t(n).find("i").attr("class","hotspot-element fa "+i),this.updateSpotList(o)},wvt.admin.hotspot.iconcolor=function(n,i,o){t(n).find("i").css({color:i}),this.updateSpotList(o)},wvt.admin.hotspot.iconsize=function(n,i,o){var e=this.getAllValue(o).width;t(n).find("i").css({"font-size":i+"px","line-height":e+"px"})},wvt.admin.hotspot.width=function(n,i){t(n).css({height:i,width:i,"line-height":i+"px"}),t(n).find("i").css({"line-height":i+"px"})},wvt.admin.hotspot.shape=function(i,o,e){var a=Object.keys(n.optioncontainer("hotspot").params.options.shape.options),s=this.getAllValue(e);if(t(i).removeClass(a.join(" ")),t(i).addClass(o),t(i).find("i").remove(),t(i).find("img").remove(),"badge"===o){var r=window.wvt_global.wvt_url+"/assets/img/badge/wvt-badge-"+s.badge+".png",c=t('<img class="hotspot-element badge" src="'+r+'"/>');t(i).css({"background-color":"transparent"}).prepend(c)}else{if("icon"===s.icontype){var d=t('<i class="fa '+s.icon+'"></i>').css({color:s.iconcolor,"font-size":s.iconsize+"px","line-height":s.width+"px"});t(i).prepend(d)}if("image"===s.icontype){c=t('<img src="'+s.iconimage+'"/>');t(i).prepend(c)}t(i).css({"background-color":s.bgcolor})}this.updateSpotList(e)},wvt.admin.hotspot.clickBehaviourChange=function(n,i,o){var e=t(n).find(".hotspot-element"),a=this.getAllValue(o);e.attr("data-click",a.click).off("click").on("click",wvt.helper.hotspotTooltipsClickBehavior.bind(wvt.helper,e,a))},wvt.admin.hotspot.click=function(t,n,i){this.clickBehaviourChange(t,n,i)},wvt.admin.hotspot.url=function(t,n,i){this.clickBehaviourChange(t,n,i)},wvt.admin.hotspot.video=function(t,n,i){this.clickBehaviourChange(t,n,i)},wvt.admin.hotspot.hoverValueChanged=function(n,i,o){var e=t(n).find(".hotspot-element"),a=this.getAllValue(o);wvt.helper.hotspotTooltipsItem(e,a)},wvt.admin.hotspot.hover=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.hotspot.hovertext=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.hotspot.hoverposition=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.hotspot.hoverlongposition=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.hotspot.hovercontent=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.hotspot.hoverminwidth=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.hotspot.hovermaxwidth=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.hotspot.hovertheme=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.hotspot.post=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.hotspot.woo=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.hotspot.wooatc=function(t,n,i){this.hoverValueChanged(t,n,i)},wvt.admin.hotspot.icontype=function(n,i,o){var e=this.getAllValue(o);if(t(n).find("i").remove(),t(n).find("img").remove(),"icon"===i){var a=t('<i class="fa '+e.icon+'"></i>').css({color:e.iconcolor,"font-size":e.iconsize+"px","line-height":e.width+"px"});t(n).prepend(a)}if("image"===i){var s=t('<img src="'+e.iconimage+'"/>');t(n).prepend(s)}this.updateSpotList(o)},wvt.admin.hotspot.iconimage=function(n,i,o){t(n).find("img").attr("src",i),this.updateSpotList(o)},wvt.admin.hotspot.badge=function(n,i,o){var e=window.wvt_global.wvt_url+"/assets/img/badge/wvt-badge-"+i+".png";t(n).find("img").attr("src",e),this.updateSpotList(o)},wvt.admin.hotspot.getAllValue=function(t){var i={};return n.optioncontainer("hotspot").segments(t).fields.each(function(t){i[t.id]=t.value.get()}),i},wvt.admin.hotspot.handleHotspotClick=function(){t(".wvt-flag-spot").length||wvt.admin.showHelper();var n=t(".wvt-panorama-container");"hotspot"===n.attr("data-flag")?n.attr("data-flag","hide"):n.attr("data-flag","hotspot"),t('.wvt-option-header .tab-list[data-id="hotspot"]').trigger("click")},wvt.admin.hotspot.newHotspot=function(){t(".wvt-panorama-container").attr("data-flag","hide");var i=n.optioncontainer("hotspot").createMultiSegment({key:"wvt-hotspot-key-"+wvt.admin.randomKey(5),coordinate:{pitch:wvt.admin.instance.getPitch(),yaw:wvt.admin.instance.getYaw(),hfov:wvt.admin.instance.getHfov()}});return n.optioncontainer("hotspot").activateTab(),n.optioncontainer("hotspot").segments(i).activateSection(),this.addSpotItem(this.hotspot.getAllValue(i),i),!1},wvt.admin.hotspot.changeActiveSegment=function(t){var n=this.getAllValue(t).coordinate;wvt.admin.instance.lookAt(parseInt(n.pitch),parseInt(n.yaw),parseInt(n.hfov),1e3)},wvt.admin.hotspot.listenSegmentEvent=function(t){this[t.type](t)},wvt.admin.hotspot.add=function(t){var n=wvt.helper.normalizeHotspotOption(t.id,this.getAllValue(t.id));wvt.admin.instance.addHotSpot(n)},wvt.admin.hotspot.remove=function(t){wvt.admin.instance.removeHotSpot(t.id)},wvt.admin.hotspot.title=function(t,n,i){this.updateSpotList(i)},wvt.admin.hotspot.updateSpotList=function(n){var i,o=this.getAllValue(n);o.id=n,i=wvt.helper.addSpotItem(o),t(".wvt-spotlist-container li[data-id="+n+"]").replaceWith(i)},wvt.admin.initialize=function(){this.prepareEditor(),this.shortcodeCopy(),this.createTooltips(),this.listenSaveButton(),this.createPanellum(),this.listenChangeDevice(),this.listenSetCenter(),this.listenSetNorth(),this.listenSetEdit(),this.listenTour(),this.listenTourSegmentEvent(),this.listenHotspot(),this.listenHotspotSegmentEvent(),this.globalVariableListener()},t(document).ready(function(){wvt.admin.initialize()})}(jQuery,wp.customize);