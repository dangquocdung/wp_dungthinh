!function(t,n){"use strict";window.wvt=window.wvt||{},wvt.admin={},wvt.admin.timeout=null,wvt.admin.option={},wvt.admin.pin={},wvt.admin.tooltips=null,wvt.admin.randomKey=function(t){for(var n="",i="abcdefghijklmnopqrstuvwxyz".length,e=0;e<t;e++)n+="abcdefghijklmnopqrstuvwxyz".charAt(Math.floor(Math.random()*i));return n},wvt.admin.getCurrentValue=function(){var t={};n.optioncontainer("option").segments("main-segment").fields.each(function(n){t[n.id]=n.value.get()});var i=[];return n.optioncontainer("pin").segments.each(function(t){var n={};t.fields.each(function(t){n[t.id]=t.value.get()}),i.push(n)}),{option:t,pin:i}},wvt.admin.createPanoramaMap=function(){var n=wvt.admin.getCurrentValue(),i=t(".wvt-panorama-map-wrapper");wvt.helper.panoramaMap(i,n),i.mousemove(this.mouseMove.bind(this)),i.on("click",this.mouseClick.bind(this))},wvt.admin.mouseClick=function(n){var i=n.target;if(!t(i).hasClass("wvt-panorama-map-pin-circle")){var e=this.mousePosition(i,n);this.pin.addNewPin(e)}},wvt.admin.initialTooltips=function(){null===this.tooltips&&(this.tooltips=t(".wvt-panorama-tooltips"),this.wrapper=t(".wvt-panorama-map-image"))},wvt.admin.mousePosition=function(t,n){const i=t.getBoundingClientRect();return{left:((n.pageX-i.x)/i.width*100).toFixed(2),top:((n.pageY-i.y)/i.height*100).toFixed(2)}},wvt.admin.mouseMove=function(t){this.initialTooltips(),this.tooltips.css({top:t.pageY,left:t.pageX});var n=this.mousePosition(this.wrapper.get(0),t);this.tooltips.find(".top strong").html(n.top+"%"),this.tooltips.find(".left strong").html(n.left+"%")},wvt.admin.prepareEditor=function(){this.scrollbarPanel(),t(window).resize(function(){this.scrollbarPanel()}.bind(this))},wvt.admin.scrollbarPanel=function(){var n=t(".wvt-panel"),i=n.find(".wvt-option-header").height(),e=t(document).height()-i,a=document.querySelector(".wvt-option-body");n.find(".wvt-option-body").css({height:e+"px"}),void 0===this.perfectScrollbar&&(this.perfectScrollbar=new PerfectScrollbar(a))},wvt.admin.optionChanged=function(t,n){void 0!==this.option[t]&&this.option[t](n)},wvt.admin.preventReload=function(t){window.onbeforeunload=t?function(){return!0}:null},wvt.admin.globalVariableListener=function(){n.variable.bind(function(t){wvt.admin.preventReload(!0);var n=null,i=/^([^\[]+)\[(.*?)\]\[(.*?)\]/i;"option"===(n=i.test(t.field)?i.exec(t.field):/^([^\[]+)\[(.*?)\]/i.exec(t.field))[1]&&this.optionChanged(n[2],t.value),"pin"===n[1]&&this.pin.valueChanged(n[2],n[3],t.value)}.bind(this))},wvt.admin.listenSaveButton=function(){t(".wvt-toolbar .wvt-save-button").on("click",this.saveButton.bind(this))},wvt.admin.saveButton=function(t){t.preventDefault(),this.saveData(this.getCurrentValue())},wvt.admin.saveData=function(n){var i=t(".wvt-save-button");i.addClass("saving").text(wvt_global.lang.saving),this.ajaxPromise(n).done(function(){i.addClass("saved").text(wvt_global.lang.saved),wvt.admin.preventReload(!1),setTimeout(function(){i.removeClass("saving saved").text(wvt_global.lang.save)},1500)})},wvt.admin.ajaxPromise=function(t){return wp.ajax.send("save_ajax_map",{data:{data:t,nonce:wvt_global.nonce,post_id:wvt_global.id}})},wvt.admin.listenPinSegmentEvent=function(){n.optioncontainer("pin").activeSegment.bind(this.pin.changeActiveSegment.bind(this.pin)),n.optioncontainer("pin").segmentEvent.bind(this.pin.listenSegmentEvent.bind(this.pin))},wvt.admin.option.getValue=function(t){return n.optioncontainer("option").segments("main-segment").fields(t).value.get()},wvt.admin.option.map=function(n){var i=t(".wvt-panorama-map-image");i.find("> img").length?"object"==typeof n&&null!==n?i.find("> img").attr("src",n.src):i.find("> img").attr("src",n):wvt.admin.createPanoramaMap()},wvt.admin.pin.getAllValue=function(t){var i={};return n.optioncontainer("pin").segments(t).fields.each(function(t){i[t.id]=t.value.get()}),i},wvt.admin.pin.addNewPin=function(i){var e=n.optioncontainer("pin").createMultiSegment({key:"wvt-pin-key-"+wvt.admin.randomKey(5),top:i.top,left:i.left}),a=this.getAllValue(e),o=t(".wvt-panorama-map-wrapper");n.optioncontainer("pin").activateTab(),n.optioncontainer("pin").segments(e).activateSection(),wvt.helper.pin.createPin(e,a,o)},wvt.admin.pin.pinClick=function(i){var e=t(i.target).attr("data-id");n.optioncontainer("pin").activateTab(),n.optioncontainer("pin").segments(e).activateSection()},wvt.admin.pin.pinMouseEnter=function(t){wvt.admin.tooltips.addClass("pin-hover")},wvt.admin.pin.pinMouseLeave=function(t){wvt.admin.tooltips.removeClass("pin-hover")},wvt.admin.pin.valueChanged=function(n,i,e){var a=wvt.helper.segmentName("pin",n),o=this.getAllValue(a).key,s=t("."+o);void 0!==wvt.admin.pin[i]&&wvt.admin.pin[i](s,e,a)},wvt.admin.pin.color=function(n,i){t(n).find(".wvt-panorama-map-pin-circle").css({"background-color":i})},wvt.admin.pin.size=function(n,i){var e=2*i;t(n).find(".wvt-panorama-map-pin-circle").css({width:e+"px",height:e+"px","margin-top":"-"+i+"px","margin-left":"-"+i+"px"})},wvt.admin.pin.listenSegmentEvent=function(t){void 0!==this[t.type]&&this[t.type](t)},wvt.admin.pin.changeActiveSegment=function(t){},wvt.admin.pin.remove=function(i){var e=n.optioncontainer("pin").segments(i.id).fields("key").value();t("."+e).remove()},wvt.admin.initialize=function(){this.prepareEditor(),this.listenSaveButton(),this.createPanoramaMap(),this.globalVariableListener(),this.listenPinSegmentEvent()},t(document).ready(function(){wvt.admin.initialize()})}(jQuery,wp.customize);