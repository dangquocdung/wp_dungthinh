!function(t){"use strict";window.wvt=window.wvt||{},wvt.helper={},wvt.helper.pin={},wvt.helper.panoramaMap=function(e,o,a){var i=o.option.map,n=new Image,r=e.find(".wvt-panorama-map-image");"object"==typeof i&&null!==i&&(i=i.src),t(n).load(function(){e.removeClass("empty-map"),r.append(n),this.resizeImageWrapper(e,n),t(window).on("resize",this.resizeImageWrapper.bind(this,e,n)),_.each(o.pin,function(t,o){this.pin.createPin(wvt.helper.segmentName("pin",o),t,e)}.bind(this)),this.draggableMap(e,n,o.pin,a),this.singlePanoramaZoom(e)}.bind(this)).error(function(){e.attr("style","").addClass("empty-map"),r.append(n),t(window).unbind("resize",this.resizeImageWrapper)}).attr("src",i)},wvt.helper.resizeImageWrapper=function(e,o){var a=this.getImageSize(o,e.parent(),!0);void 0!==window.wvtp&&(a[3]=0),t(e).css("height",a[0]).css("width",a[1]).css("left",a[2]).css("top",a[3])},wvt.helper.getImageSize=function(e,o,a){var i,n,r=t(e).height(),p=t(e).width();0===r&&(r=e.height,p=e.width);var s=(r/p).toFixed(2),l=t(o).height(),c=t(o).width(),d=l/c.toFixed(2),v=function(){return[i=c*s,n=c,(c-n)/2,(l-i)/2]},h=function(){return[i=l,n=l/s,(c-n)/2,(l-i)/2]};return a?d>s?v():h():d>s?h():v()},wvt.helper.pin.createPin=function(e,o,a){var i=2*o.size,n=void 0!==wvt_global.lang.clicktocollapse?'title="'+wvt_global.lang.clicktocollapse+'"':"",r='<div class="wvt-panorama-map-pin-item '+o.key+'" '+n+'><div class="wvt-panorama-map-pin-circle pulse" data-id="'+e+'"></div></div>';(r=t(r).css({top:o.top+"%",left:o.left+"%"})).find("> div").css({width:i+"px",height:i+"px","margin-top":"-"+o.size+"px","margin-left":"-"+o.size+"px","background-color":o.color}),a.find(".wvt-panorama-map-pin").append(r),wvt.admin&&wvt.admin.pin?(r.mouseenter(wvt.admin.pin.pinMouseEnter.bind(this)).mouseleave(wvt.admin.pin.pinMouseLeave.bind(this)),r.on("click",wvt.admin.pin.pinClick.bind(this)),r.tooltipster({theme:"tooltipster-borderless"})):window.wvtp&&o.panorama?r.on("click",function(){var t=(a=a.parents(".wvt-panorama")).attr("id"),e=a.data("sequence"),i=["wvt",o.panorama,e].join("_"),n=wvtp.instance[t];wvt.helper.showLoader(t),void 0===wvtp.scene[i]?wvt.helper.getPanorama(o.panorama).done(function(t){wvtp.scene[i]=wvt.helper.panoramaOption(t.option),n.addScene(i,wvtp.scene[i]),n.loadScene(i)}):n.loadScene(i)}):r.tooltipster({theme:"tooltipster-borderless"})},wvt.helper.singlePanoramaMap=function(e,o,a){(e=t("#"+e)).find(".wvt-single-map-container").remove(),e.append('<div class="wvt-single-map-container">'+this.createLoader()+'<div class="wvt-zoom-control"><div class="wvt-zoom-in"></div><div class="wvt-zoom-out"></div></div></div>'),this.singlePanoramaContainer(e,o.mapDimension),t(window).resize(function(){wvt.helper.singlePanoramaContainer(e,o.mapDimension)}),o.mapShow&&e.find(".wvt-single-map-container").css({visibility:"visible"}),void 0!==o.mapID&&o.mapID&&this.callAjaxMap(e.find(".wvt-single-map-container"),o.mapID,a)},wvt.helper.singlePanoramaContainer=function(t,e){var o=t.find(".pnlm-render-container").height()*e,a=t.find(".pnlm-render-container").width()*e;t.find(".wvt-single-map-container").css({height:o+"px",width:a+"px"})},wvt.helper.singlePanoramaZoom=function(t){var e=t.parents(".wvt-single-map-container"),o=e.find(".map-drag").height(),a=e.find(".map-drag").width(),i=.2*a,n=.2*o,r=1,p=function(t,o){e.find(".map-drag").css({width:t+"px",height:o+"px"}),e.find(".wvt-panorama-map-wrapper").css({width:t+"px",height:o+"px"})},s=function(t,o){e.find(".map-drag").css({top:t+"px",left:o+"px"})};e.find(".wvt-zoom-in").on("click",function(){if(r<4){p(a+=i,o+=n);var t=e.find(".map-drag").position().top,l=e.find(".map-drag").position().left;s(t-=.5*n,l-=.5*i),r++}}),e.find(".wvt-zoom-out").on("click",function(){if(e.width()<a-i&&e.height()<o-n&&r>-4){p(a-=i,o-=n);var t=e.find(".map-drag").position().top,l=e.find(".map-drag").position().left;t<-.5*n&&(t+=.5*n),o-(e.height()+Math.abs(t))<=0&&(t=-(o-e.height())),l<-.5*i&&(l+=.5*i),a-(e.width()+Math.abs(l))<=0&&(l=-(a-e.width())),s(t,l),r--}})},wvt.helper.callAjaxMap=function(t,e,o){wp.ajax.send("wvt_get_map",{data:{map_id:e}}).done(function(e){t.find(".map-drag").length?t.find(".map-drag").replaceWith('<div class="map-drag"><div class="wvt-panorama-map-wrapper"><div class="wvt-panorama-map-image"></div><div class="wvt-panorama-map-pin"></div></div></div>'):t.append('<div class="map-drag"><div class="wvt-panorama-map-wrapper"><div class="wvt-panorama-map-image"></div><div class="wvt-panorama-map-pin"></div></div></div>'),t.find(".wvt-tour-loader").fadeOut("slow"),wvt.helper.panoramaMap(t.find(".wvt-panorama-map-wrapper"),e.option,o)})},wvt.helper.draggableMap=function(e,o,a,i){var n=this.getImageSize(o,e.parent(),!0),r=e.parents(".wvt-single-map-container"),p=parseInt(r.width()/2),s=parseInt(r.height()/2),l=-(parseInt(n[0]/2)-s),c=-(parseInt(n[1]/2)-p);_.each(a,function(t,e){if(void 0!==t.panorama&&i===t.panorama){var o=n[1]-r.width(),a=n[0]-r.height();l=(l=parseFloat(t.top)*n[0]/100-s)<0?0:l>a?-a:-l,c=(c=parseFloat(t.left)*n[1]/100-p)<0?0:c>o?-o:-c}}),r.find(".map-drag").draggable({create:function(e){t(this).css({top:l+"px",left:c+"px"})},drag:function(t,e){var o=e.helper[0].parentNode,a=e.helper[0].clientWidth-o.clientWidth,i=e.helper[0].clientHeight-o.clientHeight;e.position.left>0?e.position.left=0:e.position.left<-a&&(e.position.left=-a),e.position.top>0?e.position.top=0:e.position.top<-i&&(e.position.top=-i)}})},wvt.helper.loader=function(e){t("#"+e).append(this.createLoader())},wvt.helper.hideLoader=function(e){t("#"+e).find("> .wvt-tour-loader").fadeOut("slow")},wvt.helper.showLoader=function(e){t("#"+e).find("> .wvt-tour-loader").fadeIn("fast")},wvt.helper.createLoader=function(){var t=window.wvt_global.global?window.wvt_global.global.load_scene:window.wvt_global.load_scene;return'<div class="wvt-tour-loader"><div class="'+t+'">'+this.createLoaderItem(t)+"</div></div>"},wvt.helper.createLoaderItem=function(t){var e="",o=3;"ball-grid-pulse"===t||"ball-grid-beat"===t?o=9:"ball-clip-rotate"===t||"ball-rotate"===t||"ball-scale"===t||"ball-scale-ripple"===t||"square-spin"===t||"triangle-skew-spin"===t||"semi-circle-spin"===t?o=1:"ball-clip-rotate-pulse"===t||"ball-clip-rotate-multiple"===t||"ball-zig-zag"===t||"ball-zig-zag-deflect"===t||"cube-transition"===t?o=2:"ball-pulse-rise"===t||"line-scale"===t||"line-scale-pulse-out"===t||"line-scale-pulse-out-rapid"===t||"pacman"===t?o=5:"ball-spin-fade-loader"===t||"line-spin-fade-loader"===t?o=8:"line-scale-party"===t&&(o=4);for(var a=1;a<=o;a++)e+="<div></div>";return e},wvt.helper.createToolbar=function(e,o,a){var i=(e=t("#"+e)).find(".wvt-toolbar-wrapper");i.length&&i.remove();var n=this.createToolbarWrapper(e),r=t(n).find(".wvt-zoom-control-wrapper");this.toolbarFullscreen(r,o,a),this.toolbarOrientation(r,o,a),this.toolbarZoomControl(r,o,a),this.toolbarAutorotateControl(r,o,a),this.toolbarTitle(n,o),this.toolbarScheme(e,o.toolbarScheme)},wvt.helper.toolbarScheme=function(e,o){t(e).attr("data-scheme",o)},wvt.helper.toolbarTitle=function(e,o){var a=""===o.name?'style="display: none"':"",i=""===o.name?'style="display: none"':"",n=t('<div class="wvt-panorama-title" '+a+"><h2 "+i+">"+o.name+"</h2></div>");e.append(n)},wvt.helper.createToolbarWrapper=function(e){var o=t('<div class="wvt-toolbar-wrapper"><div class="wvt-zoom-control-wrapper"></div></div>');return e.append(o),o},wvt.helper.toolbarZoomControl=function(e,o,a){var i=o.showZoomCtrl?"":'style="display: none"',n=t('<div class="wvt-zoom-control" '+i+'><div class="wvt-zoom-in"></div><div class="wvt-zoom-out"></div></div>');e.append(n),n.find(".wvt-zoom-in").on("click",function(){a.setHfov(a.getHfov()-10,200)}),n.find(".wvt-zoom-out").on("click",function(){a.setHfov(a.getHfov()+10,200)})},wvt.helper.toolbarAutorotateControl=function(e,o,a){var i=o.showRotateCtrl?"":'style="display: none"',n=t('<div class="wvt-autorotate-control" '+i+"></div>");e.append(n),o.autoRotate&&n.addClass("rotating"),n.on("click",function(){var t=o.autoRotateDirection,e=o.autoRotateSpeed;void 0!==window.wvt.admin&&(e=wvt.admin.option.getValue("autorotate_speed"),t=wvt.admin.option.getValue("autorotate")),n.hasClass("rotating")?(a.stopAutoRotate(e*t),n.removeClass("rotating")):(a.startAutoRotate(e*t),n.addClass("rotating"))})},wvt.helper.toolbarFullscreen=function(e,o,a){var i=o.showFullscreenCtrl?"":'style="display: none"',n=t('<div class="wvt-fullscreen-control" '+i+"></div>");e.append(n),n.on("click",function(){a.toggleFullscreen()})},wvt.helper.toolbarOrientation=function(e,o,a){var i=o.showOrientationCtrl?"":'style="display: none"',n=t('<div class="wvt-orientation-control" '+i+"></div>");e.append(n),n.on("click",function(){var e=t(this);e.hasClass("active")?a.stopOrientation():(a.startOrientation(),a.stopAutoRotate(),e.parent().find(".wvt-autorotate-control").removeClass("rotating")),e.toggleClass("active")})},wvt.helper.spotList=function(e,o,a){(e=t("#"+e)).find(".wvt-spotlist-container").remove(),this.prepareSpotList(e,o);var i=this.createSpotItem(o),n=e.find(".wvt-spotlist-container");n.find("ul").append(i),o.showSpotlist&&n.css({display:"block"}),this.scrollSpotList(e),this.toggleSpotList(e),this.clickSpotItem(e,a),t(window).resize(function(){wvt.helper.scrollSpotList(e)})},wvt.helper.prepareSpotList=function(t,e){var o='<div class="wvt-spotlist-container"><div class="btn-toggle"><i class="fa fa-list-ul"></i></div><div class="list-content"><span>'+window.wvt_global.lang.spotlist+"</span><ul></ul></div></div>";t.find(".wvt-toolbar-wrapper").append(o)},wvt.helper.clickSpotItem=function(e,o){e.find(".wvt-spotlist-container ul li").on("click",function(e){e.preventDefault();var a=t(this),i=JSON.parse(a.attr("data-coordinate"));o.lookAt(parseInt(i.pitch),parseInt(i.yaw),parseInt(i.hfov),1e3)})},wvt.helper.createSpotItem=function(t){var e="";return _.each(t.hotSpots,function(t,o){e+=wvt.helper.addSpotItem(t)}),e},wvt.helper.addSpotItem=function(t){var e="";return e="badge"===t.shape?'<img class="badge" src="'+window.wvt_global.wvt_url+"/assets/img/badge/wvt-badge-"+t.badge+'.png">':"icon"===t.icontype?'<i class="fa '+t.icon+'"></i>':'<img src="'+t.iconimage+'">',"<li data-id="+t.id+" data-coordinate="+JSON.stringify(t.coordinate)+">"+e+" "+t.title+"</li>"},wvt.helper.removeSpotItem=function(e){t(".wvt-spotlist-container").find(".list-content li[data-id="+e+"]").remove(),this.scrollSpotList(t(".panorama"))},wvt.helper.scrollSpotList=function(t){var e=t.find(".pnlm-render-container").height()-10,o=t.find(".wvt-spotlist-container .btn-toggle").height(),a=t.find(".wvt-spotlist-container ul").height(),i=document.querySelector(".wvt-spotlist-container ul");a>e-o&&(t.find(".wvt-spotlist-container").css({"max-height":e+"px"}),t.find(".wvt-spotlist-container ul").css({height:e-o+"px"}),i.scrollTop=0,new PerfectScrollbar(i))},wvt.helper.toggleSpotList=function(e){e.find(".wvt-spotlist-container .btn-toggle").on("click",function(o){o.stopPropagation();var a=t(this);"default"===e.attr("data-scheme")?a.parent().hasClass("expand")?(a.parent().find(".list-content ul").slideUp(),setTimeout(function(){a.parent().removeClass("expand")},300)):(a.parent().addClass("expand"),setTimeout(function(){a.parent().find(".list-content ul").slideDown()},300)):a.parent().hasClass("expand")?a.parent().removeClass("expand"):a.parent().addClass("expand")})},wvt.helper.prioritySort=function(t){var e=[],o=Object.keys(t).sort(function(e,o){return t[e].priority-t[o].priority});return _.each(o,function(o){e.push(t[o])}),e},wvt.helper.format=function(t){var e=Array.prototype.slice.call(arguments,1);return t.replace(/{(\d+)}/g,function(t,o){return void 0!==e[o]?e[o]:t})},wvt.helper.normalizeHotspotOption=function(t,e){return e.id=t,e.pitch=e.coordinate.pitch,e.yaw=e.coordinate.yaw,e.hfov=e.coordinate.hfov,e.type="info",e.cssClass="wvt-custom-hotspot wvt-"+t+" wvt-"+t.split("_")[0]+" "+e.key,e.createTooltipFunc=wvt.helper.hotspotTooltips.bind(this),e.createTooltipArgs=e,e},wvt.helper.hotspotTooltips=function(t,e){var o=this.hotspotTooltipIcons(t,e);o.attr("data-click",e.click).on("click",this.hotspotTooltipsClickBehavior.bind(this,o,e)),this.hotspotTooltipsItem(o,e)},wvt.helper.hotspotTooltipsItem=function(t,e){var o={};if(this.hotspotTooltipsDestroy(t),"none"!==e.hover){if("short"===e.hover)o.content=e.hovertext,"auto"!==e.hoverposition&&(o.side=e.hoverposition);else if("long"===e.hover)o.content='<div class="wvt-content-tooltips">'+e.hovercontent+"</div>",o.contentAsHTML=!0,"object"==typeof e.hoverlongposition?o.side=e.hoverlongposition:o.side=e.hoverlongposition.split(",");else if("post"===e.hover||"woo"===e.hover){var a={id:"post"===e.hover?e.post:e.woo,action:"post"===e.hover?"wvt_post_popup":"wvt_product_popup"};o.content='<i class="fa fa-circle-o-notch fa-spin">',o.contentAsHTML=!0,e.hovermaxwidth=e.hoverminwidth=0,wp.ajax.send(a.action,{data:{id:a.id,atc:e.wooatc}}).done(function(e){t.tooltipster("content",e)})}o.interactive=!0,o.minWidth=e.hoverminwidth,o.maxWidth=e.hovermaxwidth,o.theme="tooltipster-"+e.hovertheme,t.tooltipster(o)}},wvt.helper.hotspotTooltipsDestroy=function(t){t.hasClass("tooltipstered")&&t.tooltipster("destroy")},wvt.helper.hotspotTooltipsClickBehavior=function(e,o){if(void 0===o.spot)"none"===o.click||("url"===o.click?window.open(o.url):"video"===o.click?t.magnificPopup.open({items:{src:o.video,type:"iframe"}}):"gallery"===o.click&&t.magnificPopup.open({items:o.gallery,gallery:{enabled:!0},type:"image"}));else if(void 0!==window.wvtp&&o.spot){var a=t(o.div).parents(".wvt-panorama"),i=a.data("sequence"),n=t(a).attr("id"),r=wvtp.instance[n],p=["wvt",o.spot,i].join("_");this.showLoader(n),void 0===wvtp.scene[p]?this.getPanorama(o.spot).done(function(t){wvtp.scene[p]=wvt.helper.panoramaOption(t.option),r.addScene(p,wvtp.scene[p]),r.loadScene(p)}):r.loadScene(p)}},wvt.helper.getPanorama=function(t){return wp.ajax.send("wvt_panorama",{data:{post_id:t}})},wvt.helper.hotspotTooltipIcons=function(e,o){var a=o.width,i=null;if("badge"===o.shape){t(e).css({height:a,width:a,"line-height":a+"px"}).addClass(o.shape);var n=window.wvt_global.wvt_url+"/assets/img/badge/wvt-badge-"+o.badge+".png";i=t('<img class="hotspot-element badge" src="'+n+'"/>'),t(e).append(i)}else t(e).css({"background-color":o.bgcolor,height:a,width:a,"line-height":a+"px"}).addClass(o.shape),"icon"===o.icontype&&(i=t('<i class="fa '+o.icon+' hotspot-element"></i>').css({color:o.iconcolor,"font-size":o.iconsize+"px","line-height":a+"px"}),t(e).append(i)),"image"===o.icontype&&(i=t('<img class="hotspot-element" src="'+o.iconimage+'"/>'),t(e).append(i));return i},wvt.helper.panoramaOption=function(t){var e={},o=[];return e.autoLoad=!0,e.name=t.option.title,e.type=t.option.type,e.mapID=t.option.mapid,e.mapShow="1"===t.option.enable_map,e.mapDimension=t.option.mapdimension/100,"equirectangular"===e.type?"1"===t.option.equirectangular_external?e.panorama=t.option.equirectangular_external_url:(e.panorama=""===t.option.equirectangular?wvt_global.placeholder:t.option.equirectangular,"object"==typeof e.panorama&&null!==e.panorama&&(e.panorama=e.panorama.src)):"cubemap"===e.type&&(e.cubeMap=[],_.each(["front","back","left","right","top","bottom"],function(o){var a=t.option.cubemap[o]?t.option.cubemap[o]:wvt_global.placeholder;"object"==typeof a&&null!==a&&(a=a.src),e.cubeMap.push(a)})),e.toolbarScheme=t.option.toolbar_scheme,e.showZoomCtrl="1"===t.option.zoom,e.showFullscreenCtrl="1"===t.option.fullscreen,e.showOrientationCtrl="1"===t.option.orientation,e.compass="1"===t.option.compass,e.showSpotlist="1"===t.option.spotlist,e.pitch=parseInt(t.option.coordinate.pitch),e.yaw=parseInt(t.option.coordinate.yaw),e.hfov=parseInt(t.option.coordinate.hfov),e.northOffset=this.calculateNorth(parseInt(t.option.north)),e.height=t.option.height,e.showRotateCtrl="1"===t.option.autorotate_button,e.autoRotateSpeed=t.option.autorotate_speed,e.autoRotateDirection="clockwise"===t.option.autorotate_direction?-1:1,"1"===t.option.autorotate&&(e.autoRotate=e.autoRotateDirection*e.autoRotateSpeed,e.autoRotateInactivityDelay=3e3),e.strings={bylineLabel:"%s"},_.each(t.hotspot,function(t,e){o.push(this.normalizeHotspotOption(this.segmentName("hotspot",e),t))}.bind(this)),_.each(t.tour,function(t,e){o.push(this.normalizeHotspotOption(this.segmentName("tour",e),t))}.bind(this)),e.hotSpots=o,e},wvt.helper.calculateNorth=function(t){return(t=360-(t=parseInt(t)))>=360?t-360:t},wvt.helper.segmentName=function(t,e){return t+"_"+e},wvt.helper.scrollToTopScrollbar=function(t){document.querySelector(".wvt-option-body").scrollTop=void 0===t?0:t},wvt.helper.contextMenu=function(){var e="<a href='"+window.wvt_global.context_url+"' target='_blank'>"+window.wvt_global.context+"</a>";t(".pnlm-about-msg").html(e)}}(jQuery),function(t){"use strict";window.wvtp=[],window.wvtp.instance=[],window.wvtp.scene={},window.wvtp.create=function(t,e){var o=e.option,a=this.generateOption(t,o);wvt.helper.loader(t),wvtp.instance[t]=pannellum.viewer(t,a),wvt.helper.contextMenu(),wvtp.instance[t].on("load",function(){var e=wvtp.instance[t].getScene();wvt.helper.createToolbar(t,wvtp.scene[e],wvtp.instance[t]),wvt.helper.spotList(t,wvtp.scene[e],wvtp.instance[t]),wvt.helper.singlePanoramaMap(t,wvtp.scene[e],e.split("_")[1]),wvt.helper.hideLoader(t)})},window.wvtp.generateOption=function(t,e){var o={};return wvtp.scene[t]=o[t]=wvt.helper.panoramaOption(e),{default:{firstScene:t,sceneFadeDuration:1e3},scenes:o}},window.wvtp.populate=function(){if(Object.keys(wvtf).length)for(var t in wvtf)wvtp.create(t,wvtf[t])},window.wvtp.addToCart=function(){t(document.body).on("click",".wvt-product-atc",function(e){e.preventDefault();var o=t(this);if(!o.hasClass("loading")){o.addClass("loading"),o.prepend('<span><i class="fa fa-spinner fa-pulse"></i></span>');var a={action:"wvt_atc",product:o.data("id")};t.post(window.wvt_global.ajax,a,function(e){e.success&&(o.find(".fa").remove(),o.find("span").html('<i class="fa fa-check"></i>'),t(document.body).trigger("wc_fragment_refresh"),setTimeout(function(){o.find("span").remove(),o.removeClass("loading")},500))},"json")}})},t(document).ready(function(){wvtp.populate(),wvtp.addToCart()})}(jQuery);