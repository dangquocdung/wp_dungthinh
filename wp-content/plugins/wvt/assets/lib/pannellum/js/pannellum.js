window.pannellum=function(e,t,n){"use strict";function o(n,o){var a,i,r,s,l,c,h,d,u=this,p=!1,f=Date.now(),m=0,v=0,y=-1,g=0,w=0,b=new Array(10),P=!1,x=!1,M=!1,E=!1,L={yaw:0,pitch:0,hfov:0},k=!1,R=!1,I=0,z=0,O={},C={},H=[],S=!1,T=!1,D={hfov:100,minHfov:50,maxHfov:120,pitch:0,minPitch:void 0,maxPitch:void 0,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:void 0,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],animationTimingFunction:function(e){return e<.5?2*e*e:(4-2*e)*e-1},draggable:!0,disableKeyboardCtrl:!1,crossOrigin:"anonymous",strings:{loadButtonLabel:"Click to<br>Load<br>Panorama",loadingLabel:"Loading...",bylineLabel:"by %s",noPanoramaError:"No panorama image was specified.",fileAccessError:"The file %s could not be accessed.",malformedURLError:"There is something wrong with the panorama URL.",iOS8WebGLError:"Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).",genericWebGLError:"Your browser does not have the necessary WebGL support to display this panorama.",textureSizeError:"This panorama is too big for your device! It's %spx wide, but your device only supports images up to %spx wide. Try another device. (If you're the author, try scaling down the image.)",unknownError:"Unknown error. Check developer console."}},F=[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189];(n="string"==typeof n?t.getElementById(n):n).classList.add("pnlm-container"),n.tabIndex=0;var N=t.createElement("div");N.className="pnlm-ui",n.appendChild(N);var A=t.createElement("div");A.className="pnlm-render-container",n.appendChild(A);var Y=t.createElement("div");Y.className="pnlm-dragfix",N.appendChild(Y);var W=t.createElement("span");W.className="pnlm-about-msg",W.innerHTML='<a href="https://pannellum.org/" target="_blank">Pannellum</a>',N.appendChild(W),Y.addEventListener("contextmenu",function e(t){var n=V(t);W.style.left=n.x+"px";W.style.top=n.y+"px";clearTimeout(e.t1);clearTimeout(e.t2);W.style.display="block";W.style.opacity=1;e.t1=setTimeout(function(){W.style.opacity=0},2e3);e.t2=setTimeout(function(){W.style.display="none"},2500);t.preventDefault()});var q={},U=t.createElement("div");U.className="pnlm-sprite pnlm-hot-spot-debug-indicator",N.appendChild(U),q.container=t.createElement("div"),q.container.className="pnlm-panorama-info",q.title=t.createElement("div"),q.title.className="pnlm-title-box",q.container.appendChild(q.title),q.author=t.createElement("div"),q.author.className="pnlm-author-box",q.container.appendChild(q.author),N.appendChild(q.container),q.load={},q.load.box=t.createElement("div"),q.load.box.className="pnlm-load-box",q.load.boxp=t.createElement("p"),q.load.box.appendChild(q.load.boxp),q.load.lbox=t.createElement("div"),q.load.lbox.className="pnlm-lbox",q.load.lbox.innerHTML='<div class="pnlm-loading"></div>',q.load.box.appendChild(q.load.lbox),q.load.lbar=t.createElement("div"),q.load.lbar.className="pnlm-lbar",q.load.lbarFill=t.createElement("div"),q.load.lbarFill.className="pnlm-lbar-fill",q.load.lbar.appendChild(q.load.lbarFill),q.load.box.appendChild(q.load.lbar),q.load.msg=t.createElement("p"),q.load.msg.className="pnlm-lmsg",q.load.box.appendChild(q.load.msg),q.errorMsg=t.createElement("div"),q.errorMsg.className="pnlm-error-msg pnlm-info-box",N.appendChild(q.errorMsg);var B={};B.container=t.createElement("div"),B.container.className="pnlm-controls-container",N.appendChild(B.container),B.load=t.createElement("div"),B.load.className="pnlm-load-button",B.load.addEventListener("click",function(){Ie(),Te()}),N.appendChild(B.load),B.zoom=t.createElement("div"),B.zoom.className="pnlm-zoom-controls pnlm-controls",B.zoomIn=t.createElement("div"),B.zoomIn.className="pnlm-zoom-in pnlm-sprite pnlm-control",B.zoomIn.addEventListener("click",function(){x&&(He(a.hfov-5),ge())}),B.zoom.appendChild(B.zoomIn),B.zoomOut=t.createElement("div"),B.zoomOut.className="pnlm-zoom-out pnlm-sprite pnlm-control",B.zoomOut.addEventListener("click",function(){x&&(He(a.hfov+5),ge())}),B.zoom.appendChild(B.zoomOut),B.container.appendChild(B.zoom),B.fullscreen=t.createElement("div"),B.fullscreen.addEventListener("click",ze),B.fullscreen.className="pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control",(t.fullscreenEnabled||t.mozFullScreenEnabled||t.webkitFullscreenEnabled||t.msFullscreenEnabled)&&B.container.appendChild(B.fullscreen),B.orientation=t.createElement("div"),B.orientation.addEventListener("click",function(e){R?Fe():Ne()}),B.orientation.addEventListener("mousedown",function(e){e.stopPropagation()}),B.orientation.addEventListener("touchstart",function(e){e.stopPropagation()}),B.orientation.addEventListener("pointerdown",function(e){e.stopPropagation()}),B.orientation.className="pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control";var G,j=!1;e.DeviceOrientationEvent?e.addEventListener("deviceorientation",function t(n){e.removeEventListener("deviceorientation",t),n&&null!==n.alpha&&null!==n.beta&&null!==n.gamma?(B.container.appendChild(B.orientation),G=!0,j&&Ne()):G=!1}):G=!1;var Z=t.createElement("div");function X(){var n=t.createElement("div");if(n.innerHTML="\x3c!--[if lte IE 9]><i></i><![endif]--\x3e",1!=n.getElementsByTagName("i").length){var o,i;if(h=a.hfov,d=a.pitch,"cubemap"==a.type){for(s=[],o=0;o<6;o++)s.push(new Image),s[o].crossOrigin=a.crossOrigin;q.load.lbox.style.display="block",q.load.lbar.style.display="none"}else if("multires"==a.type){var r=JSON.parse(JSON.stringify(a.multiRes));a.basePath&&a.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(a.multiRes.basePath)?r.basePath=a.basePath+a.multiRes.basePath:a.multiRes.basePath?r.basePath=a.multiRes.basePath:a.basePath&&(r.basePath=a.basePath),s=r}else if(!0===a.dynamic)s=a.panorama;else{if(void 0===a.panorama)return void K(a.strings.noPanoramaError);s=new Image}if("cubemap"==a.type){var l=6,c=function(){0===--l&&J()},u=function(e){var n=t.createElement("a");n.href=e.target.src,n.innerHTML=n.href,K(a.strings.fileAccessError.replace("%s",n.outerHTML))};for(o=0;o<s.length;o++)s[o].onload=c,s[o].onerror=u,i=a.cubeMap[o],a.basePath&&!_(i)&&(i=a.basePath+i),s[o].src=encodeURI(i)}else if("multires"==a.type)J();else if(i="",a.basePath&&(i=a.basePath),!0!==a.dynamic){i=_(a.panorama)?a.panorama:i+a.panorama,s.onload=function(){e.URL.revokeObjectURL(this.src),J()};var p=new XMLHttpRequest;p.onloadend=function(){if(200!=p.status){var n=t.createElement("a");n.href=encodeURI(i),n.innerHTML=n.href,K(a.strings.fileAccessError.replace("%s",n.outerHTML))}var o,r,l=this.response;o=l,(r=new FileReader).addEventListener("loadend",function(){var t=r.result;if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)){var n=t.indexOf("ÿÂ");(n<0||n>65536)&&K(a.strings.iOS8WebGLError)}var i=t.indexOf("<x:xmpmeta");if(i>-1&&!0!==a.ignoreGPanoXMP){var l=t.substring(i,t.indexOf("</x:xmpmeta>")+12),c=function(e){var t;return l.indexOf(e+'="')>=0?t=(t=l.substring(l.indexOf(e+'="')+e.length+2)).substring(0,t.indexOf('"')):l.indexOf(e+">")>=0&&(t=(t=l.substring(l.indexOf(e+">")+e.length+1)).substring(0,t.indexOf("<"))),void 0!==t?Number(t):null},h={fullWidth:c("GPano:FullPanoWidthPixels"),croppedWidth:c("GPano:CroppedAreaImageWidthPixels"),fullHeight:c("GPano:FullPanoHeightPixels"),croppedHeight:c("GPano:CroppedAreaImageHeightPixels"),topPixels:c("GPano:CroppedAreaTopPixels"),heading:c("GPano:PoseHeadingDegrees"),horizonPitch:c("GPano:PosePitchDegrees"),horizonRoll:c("GPano:PoseRollDegrees")};null!==h.fullWidth&&null!==h.croppedWidth&&null!==h.fullHeight&&null!==h.croppedHeight&&null!==h.topPixels&&(H.indexOf("haov")<0&&(a.haov=h.croppedWidth/h.fullWidth*360),H.indexOf("vaov")<0&&(a.vaov=h.croppedHeight/h.fullHeight*180),H.indexOf("vOffset")<0&&(a.vOffset=-180*((h.topPixels+h.croppedHeight/2)/h.fullHeight-.5)),null!==h.heading&&H.indexOf("northOffset")<0&&(a.northOffset=h.heading,!1!==a.compass&&(a.compass=!0)),null!==h.horizonPitch&&null!==h.horizonRoll&&(H.indexOf("horizonPitch")<0&&(a.horizonPitch=h.horizonPitch),H.indexOf("horizonRoll")<0&&(a.horizonRoll=h.horizonRoll)))}s.src=e.URL.createObjectURL(o)}),void 0!==r.readAsBinaryString?r.readAsBinaryString(o):r.readAsText(o),q.load.msg.innerHTML=""},p.onprogress=function(e){if(e.lengthComputable){var t,n,o,a=e.loaded/e.total*100;q.load.lbarFill.style.width=a+"%",e.total>1e6?(t="MB",n=(e.loaded/1e6).toFixed(2),o=(e.total/1e6).toFixed(2)):e.total>1e3?(t="kB",n=(e.loaded/1e3).toFixed(1),o=(e.total/1e3).toFixed(1)):(t="B",n=e.loaded,o=e.total),q.load.msg.innerHTML=n+" / "+o+" "+t}else q.load.lbox.style.display="block",q.load.lbar.style.display="none"};try{p.open("GET",i,!0)}catch(e){K(a.strings.malformedURLError)}p.responseType="blob",p.setRequestHeader("Accept","image/*,*/*;q=0.9"),p.withCredentials="use-credentials"===a.crossOrigin,p.send()}a.draggable&&N.classList.add("pnlm-grab"),N.classList.remove("pnlm-grabbing")}else K()}function _(e){return new RegExp("^(?:[a-z]+:)?//","i").test(e)||"/"==e[0]||"blob:"==e.slice(0,5)}function J(){i||(i=new libpannellum.renderer(A)),E||(E=!0,Y.addEventListener("mousedown",Q,!1),t.addEventListener("mousemove",te,!1),t.addEventListener("mouseup",ne,!1),a.mouseZoom&&(N.addEventListener("mousewheel",de,!1),N.addEventListener("DOMMouseScroll",de,!1)),a.doubleClickZoom&&Y.addEventListener("dblclick",$,!1),N.addEventListener("mozfullscreenchange",Oe,!1),N.addEventListener("webkitfullscreenchange",Oe,!1),N.addEventListener("msfullscreenchange",Oe,!1),N.addEventListener("fullscreenchange",Oe,!1),e.addEventListener("resize",ye,!1),e.addEventListener("orientationchange",ye,!1),a.disableKeyboardCtrl||(n.addEventListener("keydown",ue,!1),n.addEventListener("keyup",fe,!1),n.addEventListener("blur",pe,!1)),t.addEventListener("mouseleave",ne,!1),Y.addEventListener("touchstart",oe,!1),Y.addEventListener("touchmove",ae,!1),Y.addEventListener("touchend",ie,!1),Y.addEventListener("pointerdown",le,!1),Y.addEventListener("pointermove",ce,!1),Y.addEventListener("pointerup",he,!1),Y.addEventListener("pointerleave",he,!1),e.navigator.pointerEnabled&&(n.style.touchAction="none")),function(){try{var e={};void 0!==a.horizonPitch&&(e.horizonPitch=a.horizonPitch*Math.PI/180),void 0!==a.horizonRoll&&(e.horizonRoll=a.horizonRoll*Math.PI/180),void 0!==a.backgroundColor&&(e.backgroundColor=a.backgroundColor),i.init(s,a.type,a.dynamic,a.haov*Math.PI/180,a.vaov*Math.PI/180,a.vOffset*Math.PI/180,Me,e),!0!==a.dynamic&&(s=void 0)}catch(e){if("webgl error"==e.type||"no webgl"==e.type)K();else{if("webgl size error"!=e.type)throw K(a.strings.unknownError),e;K(a.strings.textureSizeError.replace("%s",e.width).replace("%s",e.maxWidth))}}}(),setTimeout(function(){!0},500)}function K(e){void 0===e&&(e=a.strings.genericWebGLError),q.errorMsg.innerHTML="<p>"+e+"</p>",B.load.style.display="none",q.load.box.style.display="none",q.errorMsg.style.display="table",M=!0,A.style.display="none",Ye("error",e)}function V(e){var t=n.getBoundingClientRect(),o={};return o.x=e.clientX-t.left,o.y=e.clientY-t.top,o}function Q(e){if(e.preventDefault(),n.focus(),x&&a.draggable){var t=V(e);if(a.hotSpotDebug){var o=ee(e);console.log("Pitch: "+o[0]+", Yaw: "+o[1]+", Center Pitch: "+a.pitch+", Center Yaw: "+a.yaw+", HFOV: "+a.hfov)}Se(),Fe(),a.roll=0,L.hfov=0,p=!0,f=Date.now(),m=t.x,v=t.y,g=a.yaw,w=a.pitch,N.classList.add("pnlm-grabbing"),N.classList.remove("pnlm-grab"),Ye("mousedown",e),ge()}}function $(e){if(a.minHfov===a.hfov)u.setHfov(h,1e3);else{var t=ee(e);u.lookAt(t[0],t[1],a.minHfov,1e3)}}function ee(e){var t=V(e),n=i.getCanvas(),o=n.clientWidth,r=n.clientHeight,s=t.x/o*2-1,l=(1-t.y/r*2)*r/o,c=1/Math.tan(a.hfov*Math.PI/360),h=Math.sin(a.pitch*Math.PI/180),d=Math.cos(a.pitch*Math.PI/180),u=c*d-l*h,p=Math.sqrt(s*s+u*u),f=180*Math.atan((l*d+c*h)/p)/Math.PI,m=180*Math.atan2(s/p,u/p)/Math.PI+a.yaw;return m<-180&&(m+=360),m>180&&(m-=360),[f,m]}function te(e){if(p&&x){f=Date.now();var t=i.getCanvas(),n=t.clientWidth,o=t.clientHeight,r=V(e),s=180*(Math.atan(m/n*2-1)-Math.atan(r.x/n*2-1))/Math.PI*a.hfov/90+g;L.yaw=(s-a.yaw)%360*.2,a.yaw=s;var l=2*Math.atan(Math.tan(a.hfov/360*Math.PI)*o/n)*180/Math.PI,c=180*(Math.atan(r.y/o*2-1)-Math.atan(v/o*2-1))/Math.PI*l/90+w;L.pitch=.2*(c-a.pitch),a.pitch=c}}function ne(e){p&&(p=!1,Date.now()-f>15&&(L.pitch=L.yaw=0),N.classList.add("pnlm-grab"),N.classList.remove("pnlm-grabbing"),f=Date.now(),Ye("mouseup",e))}function oe(e){if(x&&a.draggable){Se(),Fe(),a.roll=0,L.hfov=0;var t=V(e.targetTouches[0]);if(m=t.x,v=t.y,2==e.targetTouches.length){var n=V(e.targetTouches[1]);m+=.5*(n.x-t.x),v+=.5*(n.y-t.y),y=Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y))}p=!0,f=Date.now(),g=a.yaw,w=a.pitch,Ye("touchstart",e),ge()}}function ae(e){if(a.draggable&&(e.preventDefault(),x&&(f=Date.now()),p&&x)){var t=V(e.targetTouches[0]),n=t.x,o=t.y;if(2==e.targetTouches.length&&-1!=y){var i=V(e.targetTouches[1]);n+=.5*(i.x-t.x),o+=.5*(i.y-t.y);var r=Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y));He(a.hfov+.1*(y-r)),y=r}var s=a.hfov/360,l=(m-n)*s+g;L.yaw=(l-a.yaw)%360*.2,a.yaw=l;var c=(o-v)*s+w;L.pitch=.2*(c-a.pitch),a.pitch=c}}function ie(){p=!1,Date.now()-f>150&&(L.pitch=L.yaw=0),y=-1,f=Date.now(),Ye("touchend",event)}Z.className="pnlm-compass pnlm-controls pnlm-control",N.appendChild(Z),o.firstScene?Re(o.firstScene):o.default&&o.default.firstScene?Re(o.default.firstScene):Re(null),Ie(!0);var re=[],se=[];function le(e){"touch"==e.pointerType&&(re.push(e.pointerId),se.push({clientX:e.clientX,clientY:e.clientY}),e.targetTouches=se,oe(e),e.preventDefault())}function ce(e){if("touch"==e.pointerType)for(var t=0;t<re.length;t++)if(e.pointerId==re[t])return se[t].clientX=e.clientX,se[t].clientY=e.clientY,e.targetTouches=se,void ae(e)}function he(e){if("touch"==e.pointerType){for(var t=!1,n=0;n<re.length;n++)e.pointerId==re[n]&&(re[n]=void 0),re[n]&&(t=!0);t||(re=[],se=[],ie()),e.preventDefault()}}function de(e){x&&("fullscreenonly"!=a.mouseZoom||P)&&(e.preventDefault(),Se(),f=Date.now(),e.wheelDeltaY?(He(a.hfov-.05*e.wheelDeltaY),L.hfov=e.wheelDelta<0?1:-1):e.wheelDelta?(He(a.hfov-.05*e.wheelDelta),L.hfov=e.wheelDelta<0?1:-1):e.detail&&(He(a.hfov+1.5*e.detail),L.hfov=e.detail>0?1:-1),ge())}function ue(e){Se(),f=Date.now(),Fe(),a.roll=0;var t=e.which||e.keycode;F.indexOf(t)<0||(e.preventDefault(),27==t?P&&ze():me(t,!0))}function pe(){for(var e=0;e<10;e++)b[e]=!1}function fe(e){var t=e.which||e.keycode;F.indexOf(t)<0||(e.preventDefault(),me(t,!1))}function me(e,t){var n=!1;switch(e){case 109:case 189:case 17:case 173:b[0]!=t&&(n=!0),b[0]=t;break;case 107:case 187:case 16:case 61:b[1]!=t&&(n=!0),b[1]=t;break;case 38:b[2]!=t&&(n=!0),b[2]=t;break;case 87:b[6]!=t&&(n=!0),b[6]=t;break;case 40:b[3]!=t&&(n=!0),b[3]=t;break;case 83:b[7]!=t&&(n=!0),b[7]=t;break;case 37:b[4]!=t&&(n=!0),b[4]=t;break;case 65:b[8]!=t&&(n=!0),b[8]=t;break;case 39:b[5]!=t&&(n=!0),b[5]=t;break;case 68:b[9]!=t&&(n=!0),b[9]=t}n&&t&&(l="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),ge())}function ve(e){var t=O[e],n=Math.min(1,Math.max((Date.now()-t.startTime)/1e3/(t.duration/1e3),0)),o=t.startPosition+a.animationTimingFunction(n)*(t.endPosition-t.startPosition);if(t.endPosition>t.startPosition&&o>=t.endPosition||t.endPosition<t.startPosition&&o<=t.endPosition||t.endPosition===t.startPosition){o=t.endPosition,L[e]=0;var i=O[e].callback,r=O[e].callbackArgs;delete O[e],"function"==typeof i&&i(r)}a[e]=o}function ye(){Oe()}function ge(){k||(k=!0,we())}function we(){if(function(){var e;if(x){a.yaw>180?a.yaw-=360:a.yaw<-180&&(a.yaw+=360),e=a.yaw;var t=a.maxYaw-a.minYaw,n=-180,o=180;t<360&&(n=a.minYaw+a.hfov/2,o=a.maxYaw-a.hfov/2,t<a.hfov&&(n=o=(n+o)/2)),a.yaw=Math.max(n,Math.min(o,a.yaw)),!1!==a.autoRotate&&e!=a.yaw&&(a.autoRotate*=-1);var r=i.getCanvas(),s=2*Math.atan(Math.tan(a.hfov/180*Math.PI*.5)/(r.width/r.height))/Math.PI*180,l=a.minPitch+s/2,c=a.maxPitch-s/2,h=a.maxPitch-a.minPitch;h<s&&(l=c=(l+c)/2),isNaN(l)&&(l=-90),isNaN(c)&&(c=90),a.pitch=Math.max(l,Math.min(c,a.pitch)),i.render(a.pitch*Math.PI/180,a.yaw*Math.PI/180,a.hfov*Math.PI/180,{roll:a.roll*Math.PI/180}),ke(),a.compass&&(Z.style.transform="rotate("+(-a.yaw-a.northOffset)+"deg)",Z.style.webkitTransform="rotate("+(-a.yaw-a.northOffset)+"deg)")}}(),c&&clearTimeout(c),p||!0===R)requestAnimationFrame(we);else if(b[0]||b[1]||b[2]||b[3]||b[4]||b[5]||b[6]||b[7]||b[8]||b[9]||a.autoRotate||O.pitch||O.yaw||O.hfov||Math.abs(L.yaw)>.01||Math.abs(L.pitch)>.01||Math.abs(L.hfov)>.01)!function(){if(x){var e,t=!1,n=a.pitch,o=a.yaw,i=a.hfov;e="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),void 0===l&&(l=e);var r=(e-l)*a.hfov/1700;if(r=Math.min(r,1),b[0]&&!0===a.keyboardZoom&&(He(a.hfov+(.8*L.hfov+.5)*r),t=!0),b[1]&&!0===a.keyboardZoom&&(He(a.hfov+(.8*L.hfov-.2)*r),t=!0),(b[2]||b[6])&&(a.pitch+=(.8*L.pitch+.2)*r,t=!0),(b[3]||b[7])&&(a.pitch+=(.8*L.pitch-.2)*r,t=!0),(b[4]||b[8])&&(a.yaw+=(.8*L.yaw-.2)*r,t=!0),(b[5]||b[9])&&(a.yaw+=(.8*L.yaw+.2)*r,t=!0),t&&(f=Date.now()),Date.now(),a.autoRotate){if(e-l>.001){var s=(e-l)/1e3,c=(L.yaw/s*r-.2*a.autoRotate)*s;c=(-a.autoRotate>0?1:-1)*Math.min(Math.abs(a.autoRotate*s),Math.abs(c)),a.yaw+=c}a.autoRotateStopDelay&&(a.autoRotateStopDelay-=e-l,a.autoRotateStopDelay<=0&&(a.autoRotateStopDelay=!1,z=a.autoRotate,a.autoRotate=0))}if(O.pitch&&(ve("pitch"),n=a.pitch),O.yaw&&(ve("yaw"),o=a.yaw),O.hfov&&(ve("hfov"),i=a.hfov),r>0&&!a.autoRotate&&(b[4]||b[5]||b[8]||b[9]||O.yaw||(a.yaw+=L.yaw*r*.85),b[2]||b[3]||b[6]||b[7]||O.pitch||(a.pitch+=L.pitch*r*.85),b[0]||b[1]||O.hfov||He(a.hfov+L.hfov*r*.85)),l=e,r>0){L.yaw=.8*L.yaw+(a.yaw-o)/r*.2,L.pitch=.8*L.pitch+(a.pitch-n)/r*.2,L.hfov=.8*L.hfov+(a.hfov-i)/r*.2;var h=a.autoRotate?Math.abs(a.autoRotate):5;L.yaw=Math.min(h,Math.max(L.yaw,-h)),L.pitch=Math.min(h,Math.max(L.pitch,-h)),L.hfov=Math.min(h,Math.max(L.hfov,-h))}b[0]&&b[0]&&(L.hfov=0),(b[2]||b[6])&&(b[3]||b[7])&&(L.pitch=0),(b[4]||b[8])&&(b[5]||b[9])&&(L.yaw=0)}}(),a.autoRotateInactivityDelay>=0&&z&&Date.now()-f>a.autoRotateInactivityDelay&&!a.autoRotate&&(a.autoRotate=z,u.lookAt(d,void 0,h,3e3)),requestAnimationFrame(we);else if(i&&(i.isLoading()||!0===a.dynamic&&S))requestAnimationFrame(we);else{k=!1,l=void 0;var e=a.autoRotateInactivityDelay-(Date.now()-f);e>0?c=setTimeout(function(){a.autoRotate=z,u.lookAt(d,void 0,h,3e3),ge()},e):a.autoRotateInactivityDelay>=0&&z&&(a.autoRotate=z,u.lookAt(d,void 0,h,3e3),ge())}}function be(e,t,n,o){this.w=e,this.x=t,this.y=n,this.z=o}function Pe(t,n,o){var a=function(e,t,n){var o=[t?t*Math.PI/180/2:0,n?n*Math.PI/180/2:0,e?e*Math.PI/180/2:0],a=[Math.cos(o[0]),Math.cos(o[1]),Math.cos(o[2])],i=[Math.sin(o[0]),Math.sin(o[1]),Math.sin(o[2])];return new be(a[0]*a[1]*a[2]-i[0]*i[1]*i[2],i[0]*a[1]*a[2]-a[0]*i[1]*i[2],a[0]*i[1]*a[2]+i[0]*a[1]*i[2],a[0]*a[1]*i[2]+i[0]*i[1]*a[2])}(t,n,o);a=a.multiply(new be(Math.sqrt(.5),-Math.sqrt(.5),0,0));var i=e.orientation?-e.orientation*Math.PI/180/2:0;return a.multiply(new be(Math.cos(i),0,-Math.sin(i),0))}function xe(e){var t=Pe(e.alpha,e.beta,e.gamma).toEulerAngles();"number"==typeof R&&R<10?R+=1:10===R?(I=t[2]/Math.PI*180+a.yaw,R=!0,requestAnimationFrame(we)):(a.pitch=t[0]/Math.PI*180,a.roll=-t[1]/Math.PI*180,a.yaw=-t[2]/Math.PI*180+I)}function Me(){if(a.sceneFadeDuration&&void 0!==i.fadeImg){i.fadeImg.style.opacity=0;var e=i.fadeImg;delete i.fadeImg,setTimeout(function(){A.removeChild(e),Ye("scenechangefadedone")},a.sceneFadeDuration)}a.compass?Z.style.display="inline":Z.style.display="none",function(){if(T)return;a.hotSpots?(a.hotSpots=a.hotSpots.sort(function(e,t){return e.pitch<t.pitch}),a.hotSpots.forEach(Ee)):a.hotSpots=[];T=!0,ke()}(),q.load.box.style.display="none",void 0!==r&&(A.removeChild(r),r=void 0),x=!0,Ye("load"),ge()}function Ee(e){e.pitch=Number(e.pitch)||0,e.yaw=Number(e.yaw)||0;var n=t.createElement("div");n.className="pnlm-hotspot-base",e.cssClass?n.className+=" "+e.cssClass:n.className+=" pnlm-hotspot pnlm-sprite pnlm-"+Ae(e.type);var o,i=t.createElement("span");if(e.text&&(i.innerHTML=Ae(e.text)),e.video){var r=t.createElement("video"),s=e.video;a.basePath&&!_(s)&&(s=a.basePath+s),r.src=encodeURI(s),r.controls=!0,r.style.width=e.width+"px",A.appendChild(n),i.appendChild(r)}else if(e.image){s=e.image;a.basePath&&!_(s)&&(s=a.basePath+s),(o=t.createElement("a")).href=encodeURI(e.URL?e.URL:s),o.target="_blank",i.appendChild(o);var l=t.createElement("img");l.src=encodeURI(s),l.style.width=e.width+"px",l.style.paddingTop="5px",A.appendChild(n),o.appendChild(l),i.style.maxWidth="initial"}else e.URL?((o=t.createElement("a")).href=encodeURI(e.URL),o.target="_blank",A.appendChild(o),n.style.cursor="pointer",i.style.cursor="pointer",o.appendChild(n)):(e.sceneId&&(n.onclick=n.ontouchend=function(){return n.clicked||(n.clicked=!0,De(e.sceneId,e.targetPitch,e.targetYaw,e.targetHfov)),!1},n.style.cursor="pointer",i.style.cursor="pointer"),A.appendChild(n));e.createTooltipFunc?e.createTooltipFunc(n,e.createTooltipArgs):(e.text||e.video||e.image)&&(n.classList.add("pnlm-tooltip"),n.appendChild(i),i.style.width=i.scrollWidth-20+"px",i.style.marginLeft=-(i.scrollWidth-n.offsetWidth)/2+"px",i.style.marginTop=-i.scrollHeight-12+"px"),e.clickHandlerFunc&&(n.addEventListener("click",function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)},"false"),n.style.cursor="pointer",i.style.cursor="pointer"),e.div=n}function Le(e){var t=Math.sin(e.pitch*Math.PI/180),n=Math.cos(e.pitch*Math.PI/180),o=Math.sin(a.pitch*Math.PI/180),r=Math.cos(a.pitch*Math.PI/180),s=Math.cos((-e.yaw+a.yaw)*Math.PI/180),l=t*o+n*s*r;if(e.yaw<=90&&e.yaw>-90&&l<=0||(e.yaw>90||e.yaw<=-90)&&l<=0)e.div.style.visibility="hidden";else{var c=Math.sin((-e.yaw+a.yaw)*Math.PI/180),h=Math.tan(a.hfov*Math.PI/360);e.div.style.visibility="visible";var d=i.getCanvas(),u=d.clientWidth,p=d.clientHeight,f=[-u/h*c*n/l/2,-u/h*(t*r-n*s*o)/l/2],m=Math.sin(a.roll*Math.PI/180),v=Math.cos(a.roll*Math.PI/180);(f=[f[0]*v-f[1]*m,f[0]*m+f[1]*v])[0]+=(u-e.div.offsetWidth)/2,f[1]+=(p-e.div.offsetHeight)/2;var y="translate("+f[0]+"px, "+f[1]+"px) translateZ(9999px) rotate("+a.roll+"deg)";y+=" scale("+parseInt(e.hfov)/a.hfov+") ",e.div.style.webkitTransform=y,e.div.style.MozTransform=y,e.div.style.transform=y}}function ke(){a.hotSpots.forEach(Le)}function Re(e){var t,n;a={};var i=["haov","vaov","vOffset","northOffset","horizonPitch","horizonRoll"];for(t in H=[],D)D.hasOwnProperty(t)&&(a[t]=D[t]);for(t in o.default)if(o.default.hasOwnProperty(t))if("strings"==t)for(n in o.default.strings)o.default.strings.hasOwnProperty(n)&&(a.strings[n]=Ae(o.default.strings[n]));else a[t]=o.default[t],i.indexOf(t)>=0&&H.push(t);if(null!==e&&""!==e&&o.scenes&&o.scenes[e]){var r=o.scenes[e];for(t in r)if(r.hasOwnProperty(t))if("strings"==t)for(n in r.strings)r.strings.hasOwnProperty(n)&&(a.strings[n]=Ae(r.strings[n]));else a[t]=r[t],i.indexOf(t)>=0&&H.push(t);a.scene=e}for(t in o)if(o.hasOwnProperty(t))if("strings"==t)for(n in o.strings)o.strings.hasOwnProperty(n)&&(a.strings[n]=Ae(o.strings[n]));else a[t]=o[t],i.indexOf(t)>=0&&H.push(t)}function Ie(e){if((e=e||!1)&&"preview"in a){var n=a.preview;a.basePath&&!_(n)&&(n=a.basePath+n),(r=t.createElement("div")).className="pnlm-preview-img",r.style.backgroundImage="url('"+encodeURI(n)+"')",A.appendChild(r)}var o=a.title,s=a.author;for(var l in e&&("previewTitle"in a&&(a.title=a.previewTitle),"previewAuthor"in a&&(a.author=a.previewAuthor)),a.hasOwnProperty("title")||(q.title.innerHTML=""),a.hasOwnProperty("author")||(q.author.innerHTML=""),a.hasOwnProperty("title")||a.hasOwnProperty("author")||(q.container.style.display="none"),B.load.innerHTML="<p>"+a.strings.loadButtonLabel+"</p>",q.load.boxp.innerHTML=a.strings.loadingLabel,a)if(a.hasOwnProperty(l))switch(l){case"title":q.title.innerHTML=Ae(a[l]),q.container.style.display="inline";break;case"author":q.author.innerHTML=a.strings.bylineLabel.replace("%s",Ae(a[l])),q.container.style.display="inline";break;case"fallback":q.errorMsg.innerHTML='<p>Your browser does not support WebGL.<br><a href="'+encodeURI(a[l])+'" target="_blank">Click here to view this panorama in an alternative viewer.</a></p>';break;case"hfov":He(Number(a[l]));break;case"autoLoad":!0===a[l]&&void 0===i&&(q.load.box.style.display="inline",B.load.style.display="none",X());break;case"showZoomCtrl":a[l]&&0!=a.showControls?B.zoom.style.display="block":B.zoom.style.display="none";break;case"showFullscreenCtrl":a[l]&&0!=a.showControls&&("fullscreen"in t||"mozFullScreen"in t||"webkitIsFullScreen"in t||"msFullscreenElement"in t)?B.fullscreen.style.display="block":B.fullscreen.style.display="none";break;case"hotSpotDebug":a[l]?U.style.display="block":U.style.display="none";break;case"showControls":a[l]||(B.orientation.style.display="none",B.zoom.style.display="none",B.fullscreen.style.display="none");break;case"orientationOnByDefault":a[l]&&(void 0===G?j=!0:!0===G&&Ne())}e&&(o?a.title=o:delete a.title,s?a.author=s:delete a.author)}function ze(){if(x&&!M)if(P)t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen();else try{n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.msRequestFullscreen?n.msRequestFullscreen():n.webkitRequestFullScreen()}catch(e){}}function Oe(){t.fullscreen||t.mozFullScreen||t.webkitIsFullScreen||t.msFullscreenElement?(B.fullscreen.classList.add("pnlm-fullscreen-toggle-button-active"),P=!0):(B.fullscreen.classList.remove("pnlm-fullscreen-toggle-button-active"),P=!1),i.resize(),He(a.hfov),ge()}function Ce(e){var t=a.minHfov;return"multires"==a.type&&i&&(t=Math.min(t,i.getCanvas().width/(a.multiRes.cubeResolution/90*.9))),t>a.maxHfov?(console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),a.hfov):e<t?t:e>a.maxHfov?a.maxHfov:e}function He(e){a.hfov=Ce(e)}function Se(){O={},z=a.autoRotate?a.autoRotate:z,a.autoRotate=!1}function Te(){M&&(q.load.box.style.display="none",q.errorMsg.style.display="none",M=!1,Ye("errorcleared")),B.load.style.display="none",q.load.box.style.display="inline",X()}function De(e,t,n,r,s){var l,c,h,d;if(x=!1,O={},a.sceneFadeDuration&&!s){var u=i.render(a.pitch*Math.PI/180,a.yaw*Math.PI/180,a.hfov*Math.PI/180,{returnImage:!0});if(void 0!==u)return(l=new Image).className="pnlm-fade-img",l.style.transition="opacity "+a.sceneFadeDuration/1e3+"s",l.style.width="100%",l.style.height="100%",l.onload=function(){De(e,t,n,r,!0)},l.src=u,A.appendChild(l),void(i.fadeImg=l)}c="same"===t?a.pitch:t,h="same"===n?a.yaw:"sameAzimuth"===n?a.yaw+(a.northOffset||0)-(o.scenes[e].northOffset||0):n,d="same"===r?a.hfov:r,function(){var e=a.hotSpots;if(T=!1,delete a.hotSpots,e)for(var t=0;t<e.length;t++){for(var n=e[t].div;n.parentNode!=A;)n=n.parentNode;A.removeChild(n),delete e[t].div}}(),Re(e),L.yaw=L.pitch=L.hfov=0,Ie(),void 0!==c&&(a.pitch=c),void 0!==h&&(a.yaw=h),void 0!==d&&(a.hfov=d),Ye("scenechange",e),Te()}function Fe(){e.removeEventListener("deviceorientation",xe),B.orientation.classList.remove("pnlm-orientation-button-active"),R=!1}function Ne(){R=1,e.addEventListener("deviceorientation",xe),B.orientation.classList.add("pnlm-orientation-button-active")}function Ae(e){return o.escapeHTML?String(e).split(/&/g).join("&amp;").split('"').join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split("\n").join("<br>"):String(e).split("\n").join("<br>")}function Ye(e){if(e in C)for(var t=C[e].length;t>0;t--)C[e][C[e].length-t].apply(null,[].slice.call(arguments,1))}be.prototype.multiply=function(e){return new be(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.x*e.w+this.w*e.x+this.y*e.z-this.z*e.y,this.y*e.w+this.w*e.y+this.z*e.x-this.x*e.z,this.z*e.w+this.w*e.z+this.x*e.y-this.y*e.x)},be.prototype.toEulerAngles=function(){return[Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),Math.asin(2*(this.w*this.y-this.z*this.x)),Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z))]},this.isLoaded=function(){return x},this.getPitch=function(){return a.pitch},this.setPitch=function(e,t,n,o){return(t=null==t?1e3:Number(t))?O.pitch={startTime:Date.now(),startPosition:a.pitch,endPosition:e,duration:t,callback:n,callbackArgs:o}:a.pitch=e,ge(),this},this.getPitchBounds=function(){return[a.minPitch,a.maxPitch]},this.setPitchBounds=function(e){return a.minPitch=Math.max(-90,Math.min(e[0],90)),a.maxPitch=Math.max(-90,Math.min(e[1],90)),this},this.getYaw=function(){return a.yaw},this.setYaw=function(e,t,n,o){return e=(e+180)%360-180,(t=null==t?1e3:Number(t))?(a.yaw-e>180?e+=360:e-a.yaw>180&&(e-=360),O.yaw={startTime:Date.now(),startPosition:a.yaw,endPosition:e,duration:t,callback:n,callbackArgs:o}):a.yaw=e,ge(),this},this.getYawBounds=function(){return[a.minYaw,a.maxYaw]},this.setYawBounds=function(e){return a.minYaw=Math.max(-180,Math.min(e[0],180)),a.maxYaw=Math.max(-180,Math.min(e[1],180)),this},this.getHfov=function(){return a.hfov},this.setHfov=function(e,t,n,o){return(t=null==t?1e3:Number(t))?O.hfov={startTime:Date.now(),startPosition:a.hfov,endPosition:Ce(e),duration:t,callback:n,callbackArgs:o}:He(e),ge(),this},this.getHfovBounds=function(){return[a.minHfov,a.maxHfov]},this.setHfovBounds=function(e){return a.minHfov=Math.max(0,e[0]),a.maxHfov=Math.max(0,e[1]),this},this.lookAt=function(e,t,n,o,a,i){return o=null==o?1e3:Number(o),void 0!==e&&(this.setPitch(e,o,a,i),a=void 0),void 0!==t&&(this.setYaw(t,o,a,i),a=void 0),void 0!==n&&this.setHfov(n,o,a,i),this},this.getNorthOffset=function(){return a.northOffset},this.setNorthOffset=function(e){return a.northOffset=Math.min(360,Math.max(0,e)),ge(),this},this.getHorizonRoll=function(){return a.horizonRoll},this.setHorizonRoll=function(e){return a.horizonRoll=Math.min(90,Math.max(-90,e)),i.setPose(a.horizonPitch*Math.PI/180,a.horizonRoll*Math.PI/180),ge(),this},this.getHorizonPitch=function(){return a.horizonPitch},this.setHorizonPitch=function(e){return a.horizonPitch=Math.min(90,Math.max(-90,e)),i.setPose(a.horizonPitch*Math.PI/180,a.horizonRoll*Math.PI/180),ge(),this},this.startAutoRotate=function(e){return e=e||z||1,a.autoRotate=e,u.lookAt(d,void 0,h,3e3),ge(),this},this.stopAutoRotate=function(){return z=a.autoRotate?a.autoRotate:z,a.autoRotate=!1,a.autoRotateInactivityDelay=-1,this},this.getRenderer=function(){return i},this.setUpdate=function(e){return S=!0===e,void 0===i?J():ge(),this},this.mouseEventToCoords=function(e){return ee(e)},this.loadScene=function(e,t,n,o){return x&&De(e,t,n,o),this},this.getScene=function(){return a.scene},this.addScene=function(e,t){return o.scenes[e]=t,this},this.removeScene=function(e){return!(a.scene===e||!o.scenes.hasOwnProperty(e))&&(delete o.scenes[e],!0)},this.toggleFullscreen=function(){return ze(),this},this.getConfig=function(){return a},this.getContainer=function(){return n},this.addHotSpot=function(e,t){if(void 0===t&&void 0===a.scene)a.hotSpots.push(e);else{var n=void 0!==t?t:a.scene;if(!o.scenes.hasOwnProperty(n))throw"Invalid scene ID!";o.scenes[n].hasOwnProperty("hotSpots")||(o.scenes[n].hotSpots=[],n==a.scene&&(a.hotSpots=o.scenes[n].hotSpots)),o.scenes[n].hotSpots.push(e)}return void 0!==t&&a.scene!=t||(Ee(e),x&&Le(e)),this},this.removeHotSpot=function(e){if(!a.hotSpots)return!1;for(var t=0;t<a.hotSpots.length;t++)if(a.hotSpots[t].hasOwnProperty("id")&&a.hotSpots[t].id===e){for(var n=a.hotSpots[t].div;n.parentNode!=A;)n=n.parentNode;return A.removeChild(n),delete a.hotSpots[t].div,a.hotSpots.splice(t,1),!0}return!1},this.getHotSpotConfig=function(e){if(!a.hotSpots)return!1;for(var t=0;t<a.hotSpots.length;t++)if(a.hotSpots[t].hasOwnProperty("id")&&a.hotSpots[t].id===e)return a.hotSpots[t]},this.resize=function(){ye()},this.isLoaded=function(){return x},this.isOrientationSupported=function(){return G||!1},this.stopOrientation=function(){Fe()},this.startOrientation=function(){G&&Ne()},this.isOrientationActive=function(){return Boolean(R)},this.on=function(e,t){return C[e]=C[e]||[],C[e].push(t),this},this.off=function(e,t){if(!e)return C={},this;if(t){var n=C[e].indexOf(t);n>=0&&C[e].splice(n,1),0==C[e].length&&delete C[e]}else delete C[e];return this},this.destroy=function(){i&&i.destroy(),E&&(Y.removeEventListener("mousedown",Q,!1),Y.removeEventListener("dblclick",$,!1),t.removeEventListener("mousemove",te,!1),t.removeEventListener("mouseup",ne,!1),n.removeEventListener("mousewheel",de,!1),n.removeEventListener("DOMMouseScroll",de,!1),n.removeEventListener("mozfullscreenchange",Oe,!1),n.removeEventListener("webkitfullscreenchange",Oe,!1),n.removeEventListener("msfullscreenchange",Oe,!1),n.removeEventListener("fullscreenchange",Oe,!1),e.removeEventListener("resize",ye,!1),e.removeEventListener("orientationchange",ye,!1),n.removeEventListener("keydown",ue,!1),n.removeEventListener("keyup",fe,!1),n.removeEventListener("blur",pe,!1),t.removeEventListener("mouseleave",ne,!1),Y.removeEventListener("touchstart",oe,!1),Y.removeEventListener("touchmove",ae,!1),Y.removeEventListener("touchend",ie,!1),Y.removeEventListener("pointerdown",le,!1),Y.removeEventListener("pointermove",ce,!1),Y.removeEventListener("pointerup",he,!1),Y.removeEventListener("pointerleave",he,!1)),n.innerHTML="",n.classList.remove("pnlm-container"),N.classList.remove("pnlm-grab"),N.classList.remove("pnlm-grabbing")}}return{viewer:function(e,t){return new o(e,t)}}}(window,document,jQuery);