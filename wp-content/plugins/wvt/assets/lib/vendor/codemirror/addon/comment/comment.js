!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var n={},t=/[^\s\u00a0]/,i=e.Pos;function l(e){var n=e.search(t);return-1==n?0:n}e.commands.toggleComment=function(e){e.toggleComment()},e.defineExtension("toggleComment",function(e){e||(e=n);for(var t=1/0,l=this.listSelections(),o=null,a=l.length-1;a>=0;a--){var r=l[a].from(),m=l[a].to();r.line>=t||(m.line>=t&&(m=i(t,0)),t=r.line,null==o?this.uncomment(r,m,e)?o="un":(this.lineComment(r,m,e),o="line"):"un"==o?this.uncomment(r,m,e):this.lineComment(r,m,e))}}),e.defineExtension("lineComment",function(e,o,a){a||(a=n);var r=this,m=r.getModeAt(e),c=a.lineComment||m.lineComment;if(c){if(null!=r.getLine(e.line)){var f=Math.min(0!=o.ch||o.line==e.line?o.line+1:o.line,r.lastLine()+1),g=null==a.padding?" ":a.padding,s=a.commentBlankLines||e.line==o.line;r.operation(function(){if(a.indent){for(var n=null,o=e.line;o<f;++o){var m=(d=r.getLine(o)).slice(0,l(d));(null==n||n.length>m.length)&&(n=m)}for(o=e.line;o<f;++o){var d=r.getLine(o),h=n.length;(s||t.test(d))&&(d.slice(0,h)!=n&&(h=l(d)),r.replaceRange(n+c+g,i(o,0),i(o,h)))}}else for(o=e.line;o<f;++o)(s||t.test(r.getLine(o)))&&r.replaceRange(c+g,i(o,0))})}}else(a.blockCommentStart||m.blockCommentStart)&&(a.fullLines=!0,r.blockComment(e,o,a))}),e.defineExtension("blockComment",function(e,l,o){o||(o=n);var a=this,r=a.getModeAt(e),m=o.blockCommentStart||r.blockCommentStart,c=o.blockCommentEnd||r.blockCommentEnd;if(m&&c){var f=Math.min(l.line,a.lastLine());f!=e.line&&0==l.ch&&t.test(a.getLine(f))&&--f;var g=null==o.padding?" ":o.padding;e.line>f||a.operation(function(){if(0!=o.fullLines){var n=t.test(a.getLine(f));a.replaceRange(g+c,i(f)),a.replaceRange(m+g,i(e.line,0));var s=o.blockCommentLead||r.blockCommentLead;if(null!=s)for(var d=e.line+1;d<=f;++d)(d!=f||n)&&a.replaceRange(s+g,i(d,0))}else a.replaceRange(c,l),a.replaceRange(m,e)})}else(o.lineComment||r.lineComment)&&0!=o.fullLines&&a.lineComment(e,l,o)}),e.defineExtension("uncomment",function(e,l,o){o||(o=n);var a,r=this,m=r.getModeAt(e),c=Math.min(0!=l.ch||l.line==e.line?l.line:l.line-1,r.lastLine()),f=Math.min(e.line,c),g=o.lineComment||m.lineComment,s=[],d=null==o.padding?" ":o.padding;e:if(g){for(var h=f;h<=c;++h){var u=r.getLine(h),C=u.indexOf(g);if(C>-1&&!/comment/.test(r.getTokenTypeAt(i(h,C+1)))&&(C=-1),-1==C&&(h!=c||h==f)&&t.test(u))break e;if(C>-1&&t.test(u.slice(0,C)))break e;s.push(u)}if(r.operation(function(){for(var e=f;e<=c;++e){var n=s[e-f],t=n.indexOf(g),l=t+g.length;t<0||(n.slice(l,l+d.length)==d&&(l+=d.length),a=!0,r.replaceRange("",i(e,t),i(e,l)))}}),a)return!0}var p=o.blockCommentStart||m.blockCommentStart,v=o.blockCommentEnd||m.blockCommentEnd;if(!p||!v)return!1;var b=o.blockCommentLead||m.blockCommentLead,k=r.getLine(f),L=c==f?k:r.getLine(c),x=k.indexOf(p),R=L.lastIndexOf(v);if(-1==R&&f!=c&&(L=r.getLine(--c),R=L.lastIndexOf(v)),-1==x||-1==R||!/comment/.test(r.getTokenTypeAt(i(f,x+1)))||!/comment/.test(r.getTokenTypeAt(i(c,R+1))))return!1;var O=k.lastIndexOf(p,e.ch),E=-1==O?-1:k.slice(0,e.ch).indexOf(v,O+p.length);if(-1!=O&&-1!=E&&E+v.length!=e.ch)return!1;E=L.indexOf(v,l.ch);var M=L.slice(l.ch).lastIndexOf(p,E-l.ch);return O=-1==E||-1==M?-1:l.ch+M,(-1==E||-1==O||O==l.ch)&&(r.operation(function(){r.replaceRange("",i(c,R-(d&&L.slice(R-d.length,R)==d?d.length:0)),i(c,R+v.length));var e=x+p.length;if(d&&k.slice(e,e+d.length)==d&&(e+=d.length),r.replaceRange("",i(f,x),i(f,e)),b)for(var n=f+1;n<=c;++n){var l=r.getLine(n),o=l.indexOf(b);if(-1!=o&&!t.test(l.slice(0,o))){var a=o+b.length;d&&l.slice(a,a+d.length)==d&&(a+=d.length),r.replaceRange("",i(n,o),i(n,a))}}}),!0)})});